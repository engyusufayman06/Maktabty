<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…ÙƒØªØ¨ØªÙŠ ++ | Ø±ÙÙŠÙ‚Ùƒ Ø§Ù„Ù…Ø¹Ø±ÙÙŠ</title>
<link rel="canonical" href="https://engyusufayman06.github.io/Maktabty/mmat/logo.png"> 

    <link rel="icon" type="image/png" href="https://engyusufayman06.github.io/Maktabty/mmat/logo.png"> 
    <link rel="apple-touch-icon" href="https://engyusufayman06.github.io/Maktabty/mmat/logo.png"> 

    <meta name="description" content="Ù…ÙƒØªØ¨ØªÙŠ ++: Ù…Ù†ØµØ© Ù‚Ø±Ø§Ø¡Ø© Ø±Ù‚Ù…ÙŠØ© Ù…ØªØ·ÙˆØ±Ø© Ø¨ØªØµÙ…ÙŠÙ… ÙØ¶Ø§Ø¡ Ù…Ù„Ø­Ù…ÙŠ. Ø§ÙƒØªØ´Ù ÙƒØªØ¨Ø§Ù‹ Ø¬Ø¯ÙŠØ¯Ø© Ø¨Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠØŒ ØªØªØ¨Ø¹ Ù‚Ø±Ø§Ø¡ØªÙƒØŒ Ù†Ø§ÙØ³ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ§ØªØŒ ÙˆØ§Ø³ØªÙ…ØªØ¹ Ø¨ÙˆØ§Ø¬Ù‡Ø© ØªÙØ§Ø¹Ù„ÙŠØ© ÙØ±ÙŠØ¯Ø©.">

    <meta name="keywords" content="Ù…ÙƒØªØ¨ØªÙŠ, Ù‚Ø±Ø§Ø¡Ø© ÙƒØªØ¨, Ù…ÙƒØªØ¨Ø© Ø±Ù‚Ù…ÙŠØ©, ÙƒØªØ¨ Ø¹Ø±Ø¨ÙŠØ©, Ø±ÙˆØ§ÙŠØ§Øª, Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù„Ù„ÙƒØªØ¨, ØªØ­Ø¯ÙŠ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©, ØªØ¹Ù‚Ø¨ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©, Ù…Ù„Ø®ØµØ§Øª ÙƒØªØ¨, ØªØµÙ…ÙŠÙ… Ù…ÙˆØ§Ù‚Ø¹, Glassmorphism, MyLibrary++, Arabic Books, Ebooks, Reading Tracker">

    <meta name="robots" content="index, follow">
    <meta name="author" content="Ù…ÙƒØªØ¨ØªÙŠ ++">

    <meta property="og:title" content="Ù…ÙƒØªØ¨ØªÙŠ ++ | Ø«ÙˆØ±Ø© ÙÙŠ Ø¹Ø§Ù„Ù… Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©">
    
    <meta property="og:type" content="website">
    
    <meta property="og:url" content="https://engyusufayman06.github.io/Maktabty/mmat/logo.png"> 
    
    <meta property="og:image" content="https://engyusufayman06.github.io/Maktabty/mmat/logo.png"> 
    
    <meta property="og:description" content="Ø§Ù†Ø¶Ù… Ù„Ø£Ø°ÙƒÙ‰ Ù…ÙƒØªØ¨Ø© Ø±Ù‚Ù…ÙŠØ© Ø¨ØªØµÙ…ÙŠÙ… Ø§Ù„ÙØ¶Ø§Ø¡ Ø§Ù„Ù…Ù„Ø­Ù…ÙŠ. Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠØŒ ØªØ­Ø¯ÙŠØ§Øª Ù‚Ø±Ø§Ø¡Ø©ØŒ ÙˆØªØµÙ…ÙŠÙ… Ø²Ø¬Ø§Ø¬ÙŠ ÙØ§Ø®Ø±.">
    
    <meta property="og:site_name" content="Ù…ÙƒØªØ¨ØªÙŠ ++">
    <meta property="og:locale" content="ar_AR">

    <meta name="twitter:card" content="summary_large_image">
    
    <meta name="twitter:title" content="Ù…ÙƒØªØ¨ØªÙŠ ++ | Ù…ÙƒØªØ¨ØªÙƒ ÙÙŠ Ø§Ù„ÙØ¶Ø§Ø¡">
    <meta name="twitter:description" content="ØªØ¬Ø±Ø¨Ø© Ù‚Ø±Ø§Ø¡Ø© ØºØ§Ù…Ø±Ø© Ù…Ø¹ Ù…Ø³Ø§Ø¹Ø¯ Ø°ÙƒÙŠ ÙˆØªØµÙ…ÙŠÙ… Ø²Ø¬Ø§Ø¬ÙŠ ÙØ±ÙŠØ¯. Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ Ø§Ù„Ø¢Ù†.">
    
    <meta name="twitter:image" content="https://engyusufayman06.github.io/Maktabty/mmat/logo.png"> 
    

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Ù…ÙƒØªØ¨ØªÙŠ ++",
      "url": "https://engyusufayman06.github.io/Maktabty/mmat/logo.png", 
      "description": "Ù…Ù†ØµØ© Ù‚Ø±Ø§Ø¡Ø© Ø±Ù‚Ù…ÙŠØ© Ø°ÙƒÙŠØ© Ø¨ØªØµÙ…ÙŠÙ… ØªÙØ§Ø¹Ù„ÙŠ ÙˆÙ…ÙŠØ²Ø§Øª ØªØªØ¨Ø¹ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©.",
      "applicationCategory": "EducationalApplication",
      "operatingSystem": "All",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "featureList": "Reading Tracker, AI Recommendations, Mood Search, Gamification"
    }
    </script>
    <link rel="manifest" href="data:application/manifest+json;base64,ewogICJuYW1lIjogIm1rdGJ0aSArKyIsCiAgInNob3J0X25hbWUiIjogIm1rdGJ0aSIsCiAgInN0YXJ0X3VybCI6ICIuIiwKICAiZGlzcGxheSI6ICJzdGFuZGFsb25lIiwKICAiYmFja2dyb3VuZF9jb2xvciI6ICIjMGIxMTIwIiwKICAidGhlbWVfY29sb3IiIjogIiM2MzY2ZjEiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJodHRwczovL2NkbmpzLmNsb3VkZmxhcmUuY29tL2FqYXgvbGlicy9mb250LWF3ZXNvbWUvNi40LjAvc3Zncy9zb2xpZC9ib29rLW9wZW4uc3ZnIiwKICAgICAgInNpemVzIjogIjUxMng1MTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIgogICAgfQogIF0KfQ==">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&family=Tajawal:wght@400;700;800&display=swap" rel="stylesheet">

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Cairo', 'sans-serif'],
                        heading: ['Tajawal', 'sans-serif'],
                    },
                    colors: {
                        'brand-dark': '#0f172a',
                        'brand-card': '#1e293b',
                        'brand-accent': '#6366f1',
                        'brand-secondary': '#ec4899',
                        'star-gold': '#fbbf24',
                    },
                    boxShadow: {
                        'glow': '0 0 20px rgba(99, 102, 241, 0.6)',
                        'glow-lg': '0 0 30px rgba(99, 102, 241, 0.4)',
                        'glow-pink': '0 0 20px rgba(236, 72, 153, 0.6)',
                        'glass': '0 8px 32px 0 rgba(31, 38, 135, 0.37)',
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'slide-up': 'slideUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'fade-in': 'fadeIn 0.6s ease-out forwards',
                        'shimmer': 'shimmer 2.5s linear infinite',
                        'book-breath': 'bookBreath 3s ease-in-out infinite',
                        'text-shine': 'textShine 3s linear infinite',
                        'shooting-star': 'shootingStar 5s linear infinite',
                        'spin-slow': 'spin 12s linear infinite',
                        'bounce-slight': 'bounceSlight 2s infinite',
                        'typing': 'typing 1s infinite ease-in-out',
                        'unlock': 'unlock 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards',
                        'cursor-blink': 'cursorBlink 0.7s infinite',
                        'pop': 'pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)',
                        'confetti': 'confetti 2s ease-out forwards',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-15px)' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(50px) scale(0.95)', opacity: '0' },
                            '100%': { transform: 'translateY(0) scale(1)', opacity: '1' },
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        shimmer: {
                            '0%': { backgroundPosition: '-1000px 0' },
                            '100%': { backgroundPosition: '1000px 0' }
                        },
                        bookBreath: {
                            '0%, 100%': { transform: 'scale(1) rotateY(0deg)' },
                            '50%': { transform: 'scale(1.1) rotateY(-10deg)' } 
                        },
                        textShine: {
                            '0%, 100%': { 'background-size': '200% 200%', 'background-position': 'left center' },
                            '50%': { 'background-size': '200% 200%', 'background-position': 'right center' }
                        },
                        shootingStar: {
                            '0%': { transform: 'translateX(0) translateY(0) rotate(-45deg)', opacity: '1' },
                            '100%': { transform: 'translateX(-800px) translateY(800px) rotate(-45deg)', opacity: '0' }
                        },
                        bounceSlight: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-8px)' }
                        },
                        typing: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-4px)' }
                        },
                        unlock: {
                            '0%': { transform: 'scale(0.5) rotate(-45deg)', opacity: '0' },
                            '50%': { transform: 'scale(1.5) rotate(10deg)' },
                            '100%': { transform: 'scale(1) rotate(0)', opacity: '1' }
                        },
                        cursorBlink: {
                            '0%, 100%': { opacity: '1' },
                            '50%': { opacity: '0' }
                        },
                        pop: {
                            '0%': { transform: 'scale(0.9)' },
                            '50%': { transform: 'scale(1.1)' },
                            '100%': { transform: 'scale(1)' }
                        },
                        confetti: {
                            '0%': { transform: 'translateY(0) rotateX(0) rotateY(0)', opacity: 1 },
                            '100%': { transform: 'translateY(100vh) rotateX(720deg) rotateY(360deg)', opacity: 0 }
                        }
                    }
                }
            }
        }
    </script>
    <script>
        // Apply the epic theme based on saved preference (epic/classic)
        (function(){
            try {
                document.documentElement.classList.add('antialiased');
                window.addEventListener('load', () => {
                    const saved = localStorage.getItem('uiTheme') || 'epic';
                    if (saved === 'epic') document.body.classList.add('epic-theme');

                    // subtle starfield layer for extra depth
                    const starLayer = document.createElement('div');
                    starLayer.id = 'epicStarLayer';
                    starLayer.style.position = 'fixed';
                    starLayer.style.inset = '0';
                    starLayer.style.pointerEvents = 'none';
                    starLayer.style.zIndex = '0';
                    starLayer.style.backgroundImage = 'radial-gradient(rgba(255,255,255,0.06) 1px, transparent 1px)';
                    starLayer.style.backgroundSize = '40px 40px';
                    starLayer.style.opacity = saved === 'epic' ? '0.08' : '0';
                    document.body.appendChild(starLayer);

                    // reflect current theme state in a potential toggle UI
                    const btn = document.getElementById('themeToggleBtn');
                    if (btn) btn.setAttribute('aria-pressed', saved === 'epic');
                });
            } catch(e) { console.error('Theme apply failed', e); }
        })();
    </script>

    <style>
        body {
            background-color: #0b1120;
            background-image: radial-gradient(circle at 50% 0%, #1e1b4b 0%, #0b1120 70%);
            color: #f8fafc;
            overflow-x: hidden;
            scroll-behavior: smooth;
            selection-background-color: #f472b6;
            selection-color: white;
        }

        /* --- Parallax & Dust --- */
        .stars-bg, .dust-bg {
            position: fixed; top: 0; left: 0; width: 120%; height: 120%; z-index: -2;
            transition: transform 0.05s linear;
            pointer-events: none;
        }
        .stars-bg {
            background-image: 
                radial-gradient(1px 1px at 10% 10%, rgba(255,255,255,0.8) 0%, transparent 100%),
                radial-gradient(1px 1px at 20% 20%, rgba(255,255,255,0.6) 0%, transparent 100%),
                radial-gradient(2px 2px at 30% 70%, rgba(255,255,255,0.7) 0%, transparent 100%),
                radial-gradient(1px 1px at 80% 40%, rgba(255,255,255,0.8) 0%, transparent 100%);
            background-size: 400px 400px;
            opacity: 0.6;
        }
        .dust-bg {
            z-index: -1;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.7' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.04'/%3E%3C/svg%3E");
            opacity: 0.3;
        }
        
        /* Shooting Star */
        .shooting-star {
            position: fixed; top: 10%; right: 5%; width: 150px; height: 2px;
            background: linear-gradient(to left, rgba(255,255,255,0), rgba(255,255,255,1), rgba(168, 85, 247, 0.5));
            z-index: -1; animation: shootingStar 7s linear infinite; animation-delay: 3s;
            opacity: 0; border-radius: 50%; box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        /* --- Container Hover Logic --- */
        .book-container-wrapper { transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .book-container-wrapper:hover { transform: translateY(-20px) scale(1.08); z-index: 30; }
        .book-container-wrapper:hover .book-wrapper { filter: drop-shadow(0 20px 30px rgba(99, 102, 241, 0.4)); }

        /* --- Book 3D Styles --- */
        .book-wrapper {
            perspective: 1200px; width: 140px; height: 210px; position: relative;
            cursor: pointer; flex-shrink: 0; animation: float 7s ease-in-out infinite;
            animation-delay: var(--delay, 0s); transition: filter 0.4s ease;
        }
        
        .book-3d {
            width: 100%; height: 100%; transform-style: preserve-3d;
            transition: transform 0.6s cubic-bezier(0.2, 0.8, 0.2, 1); position: relative; 
            box-shadow: 0 15px 35px rgba(0,0,0,0.5), inset 0 0 20px rgba(255,255,255,0.05);
        }

        .book-wrapper:hover .book-3d {
            transform: rotateY(-20deg) rotateX(5deg) translateZ(40px);
            box-shadow: -30px 50px 70px rgba(0,0,0,0.6);
        }

        .book-cover {
            position: absolute; width: 100%; height: 100%; background-size: cover; background-position: center;
            border-radius: 4px 10px 10px 4px; z-index: 2; backface-visibility: hidden;
            overflow: hidden; border-left: 1px solid rgba(255,255,255,0.2);
        }
        
        .book-cover::after {
            content: ''; position: absolute; top: 0; left: 0; width: 250%; height: 100%;
            background: linear-gradient(120deg, transparent 0%, transparent 40%, rgba(255,255,255,0.3) 50%, transparent 60%, transparent 100%);
            transform: translateX(-150%) skewX(-20deg); transition: transform 0.8s;
        }
        .book-wrapper:hover .book-cover::after {
            transform: translateX(150%) skewX(-20deg); transition: transform 1s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .book-spine {
            position: absolute; top: 0; left: 0; width: 24px; height: 100%;
            transform: rotateY(90deg) translateZ(-12px); background: inherit;
            filter: brightness(0.7); border-radius: 4px 0 0 4px; z-index: 1;
            transition: filter 0.3s; box-shadow: inset 2px 0 5px rgba(0,0,0,0.3);
        }
        
        .book-wrapper:hover .book-spine {
            filter: brightness(1.1); box-shadow: -5px 0 20px rgba(99, 102, 241, 0.3);
        }

        .book-pages {
            position: absolute; top: 4px; right: 0; width: 22px; height: calc(100% - 8px);
            background: linear-gradient(to right, #e2e8f0, #f8fafc 10%, #e2e8f0 20%, #f8fafc 30%, #e2e8f0 40%, #f8fafc 50%, #e2e8f0 60%, #f8fafc 70%, #e2e8f0 80%, #f8fafc 90%, #cbd5e1);
            transform: rotateY(90deg) translateZ(-10px); border-radius: 0 4px 4px 0;
            transition: transform 0.4s; box-shadow: inset 0 0 5px rgba(0,0,0,0.1);
        }

        .book-wrapper:hover .book-pages {
            transform: rotateY(90deg) translateZ(-10px) translateX(4px);
        }

        /* --- Scrollbar --- */
        .custom-h-scroll {
            scrollbar-width: thin; scrollbar-color: #6366f1 #1e293b; padding-bottom: 20px;
        }
        .custom-h-scroll::-webkit-scrollbar { height: 6px; }
        .custom-h-scroll::-webkit-scrollbar-track { background: rgba(30, 41, 59, 0.5); border-radius: 10px; margin: 0 20px; }
        .custom-h-scroll::-webkit-scrollbar-thumb { background: linear-gradient(90deg, #6366f1, #a855f7, #ec4899); border-radius: 10px; }
        .custom-h-scroll::-webkit-scrollbar-thumb:hover { background: #818cf8; }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }

        /* Glass Utility */
        .glass-morphism {
            background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px); border-bottom: 1px solid rgba(255,255,255,0.08);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .glass-card {
            background: rgba(30, 41, 59, 0.6); backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px); border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.2);
        }

        /* Flying Animation */
        .flying-img {
            position: fixed; z-index: 100; pointer-events: none; 
            transition: top 0.8s cubic-bezier(0.5, 0, 0.5, 1), left 0.8s cubic-bezier(0.5, 0, 0.5, 1), width 0.8s, height 0.8s, opacity 0.8s;
            box-shadow: 0 10px 25px rgba(255, 255, 255, 0.3); filter: contrast(1.2); border-radius: 4px;
        }
        
        .tag-scroll { -ms-overflow-style: none; scrollbar-width: none; }
        .tag-scroll::-webkit-scrollbar { display: none; }

        .reveal-on-scroll { opacity: 0; transform: translateY(40px) scale(0.95); transition: all 0.8s cubic-bezier(0.2, 0.8, 0.2, 1); }
        .reveal-on-scroll.visible { opacity: 1; transform: translateY(0) scale(1); }

        @keyframes shelfBounce {
            0% { transform: scale(1); } 30% { transform: scale(1.25) rotate(-5deg); }
            50% { transform: scale(1.25) rotate(5deg); } 70% { transform: scale(1.1) rotate(-2deg); }
            100% { transform: scale(1); }
        }
        .shelf-bounce { animation: shelfBounce 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); }

        /* Scroll Top Button */
        #scrollTopBtn {
            opacity: 0; visibility: hidden; transform: translateY(20px);
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        #scrollTopBtn.visible { opacity: 1; visibility: visible; transform: translateY(0); }

        /* Chat Bot Widget */
        .chat-widget { transition: all 0.5s cubic-bezier(0.19, 1, 0.22, 1); }
        .chat-widget.open { width: 380px; height: 600px; border-radius: 24px; bottom: 30px; left: 30px; }
        @media (max-width: 640px) {
            .chat-widget.open { width: 90%; left: 5%; bottom: 90px; height: 65vh; }
        }
        .chat-messages::-webkit-scrollbar { width: 4px; }
        
        /* Badge Styles */
        .badge-locked { filter: grayscale(100%) opacity(0.3); transform: scale(0.9); }
        .badge-unlocked { 
            animation: unlock 0.8s cubic-bezier(0.34, 1.56, 0.64, 1); 
            filter: drop-shadow(0 0 8px rgba(251, 191, 36, 0.6)); border: 1px solid rgba(251, 191, 36, 0.5);
        }

        /* Range Slider Styling */
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 18px; width: 18px; border-radius: 50%;
            background: #f472b6; cursor: pointer; margin-top: -7px;
            box-shadow: 0 0 10px rgba(244, 114, 182, 0.6); transition: transform 0.2s;
        }
        input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.2); }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px; cursor: pointer; background: #334155; border-radius: 4px;
        }
        
        /* Typing Cursor */
        .typing-cursor {
            display: inline-block; width: 6px; height: 16px; background-color: #f472b6;
            margin-right: 3px; animation: cursorBlink 0.8s infinite; vertical-align: middle; border-radius: 2px;
        }

        /* Confetti Particle */
        .confetti-piece {
            position: absolute; width: 10px; height: 10px; background-color: #ffd700;
            top: 0; opacity: 0; z-index: 300;
        }

    </style>
    <!-- Epic Theme Overrides: dramatic, modern, neon-glass look -->
    <style>
        :root{
            --epic-bg-1: #05040a;
            --epic-bg-2: #0b1020;
            --epic-accent-a: #7c3aed;
            --epic-accent-b: #06b6d4;
            --epic-glow: 0 10px 40px rgba(124,58,237,0.18);
            --epic-card: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
            --epic-border: rgba(124,58,237,0.18);
        }

        body.epic-theme { 
            background: radial-gradient(1200px 600px at 10% 10%, rgba(99,102,241,0.06), transparent 10%),
                        radial-gradient(1000px 500px at 90% 90%, rgba(236,72,153,0.04), transparent 10%),
                        linear-gradient(180deg,var(--epic-bg-1), var(--epic-bg-2));
            color: #e6eef8; 
            transition: background 0.8s ease;
        }

        /* Header: bigger, glassy, neon accent */
        body.epic-theme header.glass-morphism {
            background: linear-gradient(180deg, rgba(10,8,20,0.6), rgba(10,8,20,0.35));
            border-bottom: 1px solid rgba(124,58,237,0.12);
            box-shadow: var(--epic-glow);
            backdrop-filter: blur(8px) saturate(120%);
        }

        /* Brand Logo larger */
        body.epic-theme h1 { text-shadow: 0 6px 30px rgba(124,58,237,0.12); }

        /* Search input â€” make it prominent */
        body.epic-theme #searchInput {
            background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
            border: 1px solid rgba(124,58,237,0.12);
            box-shadow: 0 6px 30px rgba(6,182,212,0.03) inset;
        }

        /* Buttons: epic gradients */
        body.epic-theme .glass-card, body.epic-theme .glass-morphism, body.epic-theme .glass-card {
            background: var(--epic-card);
            border: 1px solid var(--epic-border);
            box-shadow: 0 8px 40px rgba(2,6,23,0.6);
        }

        body.epic-theme button.start, body.epic-theme .start { background: linear-gradient(90deg,var(--epic-accent-b),var(--epic-accent-a)); box-shadow: 0 8px 30px rgba(124,58,237,0.12); }

        /* Book cards: neon rim, glass plate */
        body.epic-theme .book-container-wrapper { transform-origin: center; transition: transform 0.45s cubic-bezier(.2,.9,.3,1), box-shadow 0.45s; }
        body.epic-theme .book-container-wrapper:hover { transform: translateY(-18px) scale(1.06) rotate(-1deg); box-shadow: 0 30px 80px rgba(99,102,241,0.12); }
        body.epic-theme .book-cover { border-radius: 12px; border-left: none; box-shadow: 0 20px 40px rgba(2,6,23,0.6); overflow: hidden; }

        /* Neon accent around covers */
        body.epic-theme .book-cover::before{
            content: '';
            position: absolute; inset: 0; pointer-events: none; mix-blend-mode: overlay;
            background: linear-gradient(180deg, rgba(124,58,237,0.06), rgba(6,182,212,0.03));
        }

        /* Modal epic styling */
        body.epic-theme .relative.bg-slate-800, body.epic-theme .modal-epic {
            background: linear-gradient(180deg, rgba(8,10,20,0.85), rgba(6,8,18,0.95));
            border: 1px solid rgba(124,58,237,0.12);
            box-shadow: 0 40px 120px rgba(2,6,23,0.8);
        }

        /* Footer polish */
        body.epic-theme footer { background: linear-gradient(180deg, rgba(2,6,23,0.6), rgba(2,6,23,0.9)); border-top: 1px solid rgba(124,58,237,0.06); }

        /* Make icons glow */
        body.epic-theme .fa-solid, body.epic-theme .fa-regular { transition: transform 0.3s; }
        body.epic-theme .fa-solid:hover { transform: translateY(-4px) scale(1.08); filter: drop-shadow(0 6px 20px rgba(124,58,237,0.18)); }

        /* QuickTags elevated */
        body.epic-theme #quickTags button { background: linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border: 1px solid rgba(124,58,237,0.06); }

        /* Shelf tweaks */
        body.epic-theme #myShelf { background: linear-gradient(180deg, rgba(8,10,20,0.9), rgba(6,8,18,0.95)); border-left: 1px solid rgba(124,58,237,0.08); }

        /* Expanded shelf / fullscreen view (toggle with JS) */
        #myShelf.shelf-expanded { width: 100% !important; max-width: none !important; }
        #myShelf.shelf-expanded .p-6 { padding-left: 18px; padding-right: 18px; }
        #myShelf.shelf-expanded #shelfContent { display: grid !important; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 16px; padding: 20px; align-content: start; }
        #myShelf.shelf-expanded .glass-card { margin: 0 !important; }
        /* Make sure shelf overlays other content clearly */
        #myShelf { z-index: 60; }
        #shelfContent { min-height: 180px; z-index: 70; overflow-y: auto; }

        /* Expand button visuals */
        #expandShelfBtn.active { background: linear-gradient(90deg,#7c3aed,#06b6d4); color: #021026; transform: scale(1.03); }

        /* subtle animation for hero */
        @keyframes epicPulse { 0% { transform: translateY(0); } 50% { transform: translateY(-6px) scale(1.01);} 100% { transform: translateY(0);} }
        body.epic-theme .animate-float { animation: epicPulse 6s ease-in-out infinite; }

        /* responsive small tweaks */
        @media (max-width:640px) {
            body.epic-theme header .container { padding-left: 10px; padding-right: 10px; }
            body.epic-theme h1 { font-size: 1.6rem; }
        }
    </style>
</head>
<body class="flex flex-col min-h-screen font-sans selection:bg-pink-500 selection:text-white">

    <!-- Parallax Layers -->
    <div class="stars-bg" id="starsContainer"></div>
    <div class="dust-bg" id="dustContainer"></div>
    <div class="shooting-star"></div>

    <!-- Header -->
    <header class="glass-morphism sticky top-0 z-50 transition-all duration-300" id="mainHeader">
        <div class="container mx-auto px-4 py-3">
            <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                
                <div class="flex items-center gap-4 group cursor-pointer" onclick="goHome()">
                    <div class="relative transform group-hover:scale-110 transition-transform duration-300">
                        <i class="fa-solid fa-book-open text-4xl text-indigo-400 animate-book-breath drop-shadow-glow"></i>
                        <div class="absolute inset-0 bg-indigo-500 blur-2xl opacity-30 rounded-full animate-pulse-slow"></div>
                    </div>
                    <div>
                        <h1 class="text-3xl font-heading font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-indigo-300 via-purple-300 to-pink-300 animate-text-shine drop-shadow-sm">
                            Ù…ÙƒØªØ¨ØªÙŠ ++
                        </h1>
                        <p id="greetingText" class="text-[12px] text-slate-400 font-bold hidden md:block opacity-0 animate-fade-in tracking-wide" style="animation-delay: 0.5s">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ø¨Ø§Ø­Ø«</p>
                    </div>
                </div>

                <div class="flex-1 flex gap-2 w-full md:max-w-xl relative">
                    <div class="relative w-full group">
                        <div class="absolute inset-y-0 right-0 flex items-center pr-5 pointer-events-none text-slate-400 group-focus-within:text-indigo-400 transition-colors">
                            <i class="fa-solid fa-search text-lg"></i>
                        </div>
                        <input type="text" id="searchInput" 
                            class="w-full bg-slate-800/60 border border-slate-600/50 text-slate-100 text-sm rounded-full focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500 block w-full pr-12 pl-12 py-3.5 transition-all duration-300 shadow-inner placeholder-slate-500 hover:bg-slate-800/80 focus:scale-[1.01] backdrop-blur-md" 
                            placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù†ÙˆØ§Ù†ØŒ Ù…Ø¤Ù„ÙØŒ Ø£Ùˆ Ù…Ø¬Ø§Ù„..." autocomplete="off">
                        
                        <!-- Search History Dropdown -->
                        <div id="searchHistoryDropdown" class="absolute top-full right-0 w-full mt-2 bg-slate-800/95 border border-slate-600 rounded-2xl shadow-2xl hidden z-50 overflow-hidden backdrop-blur-xl ring-1 ring-white/10">
                            <div class="p-3 text-[11px] text-slate-400 bg-slate-900/80 border-b border-slate-700 flex justify-between">
                                <span class="font-bold">Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</span>
                                <button onclick="clearSearchHistory()" class="text-red-400 hover:text-red-300 hover:underline transition-all">Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
                            </div>
                            <ul id="historyList" class="max-h-48 overflow-y-auto"></ul>
                        </div>

                        <!-- Live Suggestions Dropdown -->
                        <div id="suggestionsDropdown" class="absolute top-full right-0 w-full mt-2 bg-slate-800/95 border border-slate-600 rounded-2xl shadow-2xl hidden z-50 overflow-hidden backdrop-blur-xl ring-1 ring-white/10">
                            <div id="suggestionsList" class="py-2"></div>
                            <div id="suggestionsFooter" class="px-3 py-2 border-t border-slate-700/50 text-xs text-slate-400 hidden"></div>
                        </div>

                        <style>
                            /* Suggestions dropdown */
                            #suggestionsDropdown { animation: fadeIn 220ms ease; }
                            #suggestionsDropdown .suggestion-item { display:flex; gap:10px; align-items:center; padding:8px 12px; cursor:pointer; transition: background .12s; }
                            #suggestionsDropdown .suggestion-item:hover, #suggestionsDropdown .suggestion-item.active { background: rgba(99,102,241,0.06); }
                            #suggestionsDropdown img.thumb { width:40px; height:56px; object-fit:cover; border-radius:6px; flex-shrink:0; }
                            #suggestionsDropdown .meta { overflow:hidden; min-width:0 }
                            #suggestionsDropdown .meta .title { font-weight:700; color:#e6eef8; font-size:13px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
                            #suggestionsDropdown .meta .author { font-size:12px; color:#9aa6bf }
                            #suggestionsDropdown .badge { font-size:11px; color:#021026; background:linear-gradient(90deg,#06b6d4,#7c3aed); padding:4px 8px; border-radius:999px; margin-left:8px; }
                            #suggestionsDropdown .no-results { padding:14px; text-align:center; color:#9aa6bf }
                            @keyframes fadeIn { from { opacity:0; transform: translateY(-6px) } to { opacity:1; transform:none } }
                        </style>

                        <button onclick="searchBooks()" class="absolute left-1.5 top-1.5 bg-gradient-to-br from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 text-white rounded-full w-10 h-10 flex items-center justify-center transition-transform hover:rotate-90 hover:scale-110 shadow-lg shadow-indigo-500/30">
                            <i class="fa-solid fa-arrow-left"></i>
                        </button>
                    </div>
                </div>

                <div class="flex gap-3 items-center">
                    <button onclick="openSettingsModal()" class="w-12 h-12 bg-slate-800/60 rounded-full border border-slate-600 hover:bg-slate-700 hover:border-slate-500 transition-all text-slate-300 hover:text-white group shadow-lg flex items-center justify-center backdrop-blur-sm">
                        <i class="fa-solid fa-gear text-xl group-hover:rotate-180 transition-transform duration-500"></i>
                    </button>

                    <button id="cartBtn" onclick="toggleShelf()" class="relative group transform transition-transform duration-300 hover:-translate-y-1">
                        <div class="bg-gradient-to-br from-slate-800 to-slate-900 p-4 rounded-2xl border border-slate-600 group-hover:border-pink-500/50 transition-all duration-300 shadow-lg group-hover:shadow-glow-pink">
                            <i class="fa-solid fa-book-open-reader text-3xl text-pink-500 group-hover:animate-bounce drop-shadow-md"></i>
                        </div>
                        <span id="shelfCount" class="absolute -top-2 -right-2 flex h-7 w-7 items-center justify-center rounded-full bg-gradient-to-r from-pink-500 to-purple-600 text-xs font-bold text-white shadow-lg border-2 border-slate-900 scale-0 transition-transform duration-300">0</span>
                    </button>
                </div>
            </div>
            
            <div class="mt-4 flex gap-2 overflow-x-auto tag-scroll pb-2" id="quickTags"></div>
        </div>
    </header>

    <main class="flex-grow container mx-auto px-4 py-10 relative">
        <div id="homeView" class="animate-slide-up">
            <section class="text-center py-12 md:py-20 relative">
                <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-64 h-64 bg-indigo-500/10 rounded-full blur-3xl pointer-events-none animate-pulse-slow"></div>
                
                <div class="inline-block p-8 rounded-full bg-gradient-to-br from-indigo-500/10 to-purple-500/10 mb-8 backdrop-blur-md border border-indigo-500/20 animate-float hover:scale-110 transition-transform cursor-pointer shadow-glow">
                    <i class="fa-solid fa-book-journal-whills text-7xl text-transparent bg-clip-text bg-gradient-to-br from-indigo-300 to-purple-300 drop-shadow-sm"></i>
                </div>
                
                <h2 id="dynamicWelcome" class="text-4xl md:text-6xl font-heading font-extrabold mb-6 text-white min-h-[4.5rem] opacity-0 animate-fade-in drop-shadow-lg leading-tight" style="animation-delay: 0.3s"></h2>
                
                <p class="text-slate-300 max-w-xl mx-auto text-xl mb-10 opacity-0 animate-fade-in font-light tracking-wide">Ù…Ù†ØµØ© ØªÙØ§Ø¹Ù„ÙŠØ© Ù…ØµÙ…Ù…Ø© Ø®ØµÙŠØµØ§Ù‹ Ù„ÙƒØŒ Ù„Ù„Ø§ÙƒØªØ´Ø§ÙØŒ Ø§Ù„Ø­ÙØ¸ØŒ ÙˆØ§Ù„Ø¥Ù„Ù‡Ø§Ù….</p>
                
                <div class="flex justify-center gap-6 mb-12 animate-fade-in flex-wrap" style="animation-delay: 0.8s">
                    <button onclick="searchByMood('happy')" class="glass-card px-6 py-3 rounded-full hover:bg-yellow-500/10 hover:border-yellow-400 hover:scale-105 transition-all text-sm font-bold text-yellow-100 flex items-center gap-3 group shadow-lg">
                        <span class="text-xl group-hover:animate-bounce">ğŸ˜Š</span> ÙƒØªØ¨ ØªØ¨Ù‡Ø¬Ùƒ
                    </button>
                    <button onclick="searchByMood('mystery')" class="glass-card px-6 py-3 rounded-full hover:bg-purple-500/10 hover:border-purple-400 hover:scale-105 transition-all text-sm font-bold text-purple-100 flex items-center gap-3 group shadow-lg">
                        <span class="text-xl group-hover:animate-pulse">ğŸ•µï¸</span> ØºÙ…ÙˆØ¶ ÙˆØªØ´ÙˆÙŠÙ‚
                    </button>
                    <button onclick="searchByMood('love')" class="glass-card px-6 py-3 rounded-full hover:bg-pink-500/10 hover:border-pink-400 hover:scale-105 transition-all text-sm font-bold text-pink-100 flex items-center gap-3 group shadow-lg">
                        <span class="text-xl group-hover:animate-ping">â¤ï¸</span> Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠØ©
                    </button>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-5xl mx-auto mt-16">
                    <div class="glass-card p-6 rounded-2xl hover:bg-slate-800/40 transition-all duration-500 hover:-translate-y-3 reveal-on-scroll border-t border-white/5 bg-gradient-to-b from-slate-800/40 to-slate-900/40">
                        <div class="w-12 h-12 bg-purple-500/20 rounded-xl flex items-center justify-center mb-4 mx-auto border border-purple-500/30">
                            <i class="fa-solid fa-brain text-purple-400 text-2xl drop-shadow-md"></i>
                        </div>
                        <h3 class="font-bold text-xl text-white mb-2">ØªÙ†Ø¸ÙŠÙ… Ø°ÙƒÙŠ</h3>
                        <p class="text-sm text-slate-400">Ø§Ø­ØªÙØ¸ Ø¨ÙƒØªØ¨ÙƒØŒ Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒØŒ ÙˆØªØªØ¨Ø¹ ØªÙ‚Ø¯Ù…Ùƒ ÙÙŠ Ù…ÙƒØ§Ù† ÙˆØ§Ø­Ø¯ Ø£Ù†ÙŠÙ‚.</p>
                    </div>
                    <div class="glass-card p-6 rounded-2xl hover:bg-slate-800/40 transition-all duration-500 hover:-translate-y-3 reveal-on-scroll border-t border-white/5 bg-gradient-to-b from-slate-800/40 to-slate-900/40" style="transition-delay: 0.1s">
                        <div class="w-12 h-12 bg-yellow-500/20 rounded-xl flex items-center justify-center mb-4 mx-auto border border-yellow-500/30">
                            <i class="fa-solid fa-bolt text-yellow-400 text-2xl drop-shadow-md"></i>
                        </div>
                        <h3 class="font-bold text-xl text-white mb-2">Ø¨Ø­Ø« ÙÙˆØ±ÙŠ</h3>
                        <p class="text-sm text-slate-400">Ù…Ø­Ø±Ùƒ Ø¨Ø­Ø« Ù‚ÙˆÙŠ ÙŠØµÙ„Ùƒ Ø¨Ø¢Ù„Ø§Ù Ø§Ù„Ù…ØµØ§Ø¯Ø± Ø¨Ø¶ØºØ·Ø© Ø²Ø± ÙˆØ§Ø­Ø¯Ø©.</p>
                    </div>
                    <div class="glass-card p-6 rounded-2xl hover:bg-slate-800/40 transition-all duration-500 hover:-translate-y-3 reveal-on-scroll border-t border-white/5 bg-gradient-to-b from-slate-800/40 to-slate-900/40" style="transition-delay: 0.2s">
                        <div class="w-12 h-12 bg-pink-500/20 rounded-xl flex items-center justify-center mb-4 mx-auto border border-pink-500/30">
                            <i class="fa-solid fa-lightbulb text-pink-400 text-2xl drop-shadow-md"></i>
                        </div>
                        <h3 class="font-bold text-xl text-white mb-2">Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ù…Ù„Ù‡Ù…Ø©</h3>
                        <p class="text-sm text-slate-400">Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ÙŠØ³Ø§Ø¹Ø¯Ùƒ ÙÙŠ Ø§Ø®ØªÙŠØ§Ø± Ø±Ø­Ù„ØªÙƒ Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© Ø¨ÙŠÙ† Ø§Ù„ÙƒØªØ¨.</p>
                    </div>
                </div>
            </section>

            <section class="mb-16 max-w-4xl mx-auto text-center hidden reveal-on-scroll" id="quoteSection">
                <div class="glass-card p-8 rounded-3xl border-r-4 border-indigo-500 transform transition-transform hover:scale-[1.02] bg-gradient-to-r from-slate-800/60 to-indigo-900/20 relative overflow-hidden">
                    <div class="absolute top-0 right-0 -mr-4 -mt-4 w-24 h-24 bg-indigo-500/10 rounded-full blur-xl"></div>
                    <i class="fa-solid fa-quote-right text-indigo-400/40 text-5xl mb-4 block text-right"></i>
                    <p id="dailyQuote" class="text-2xl font-heading text-slate-100 italic mb-4 leading-relaxed font-light">"Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ù‡ÙŠ ØªØ°ÙƒØ±Ø© Ø³ÙØ± Ù„ÙƒÙ„ Ù…ÙƒØ§Ù†."</p>
                    <p class="text-base text-indigo-400 font-bold tracking-wider">- Ø­ÙƒÙ…Ø© Ø§Ù„ÙŠÙˆÙ…</p>
                </div>
            </section>

            <section id="trendingSection" class="mb-16">
                <div class="flex items-center justify-between mb-6 px-4">
                    <div class="flex items-center gap-3">
                        <div class="bg-blue-500/20 p-2 rounded-lg">
                            <i class="fa-solid fa-earth-americas text-blue-400 text-xl animate-spin-slow"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-white">Ø§Ù„Ø£ÙƒØ«Ø± Ø±ÙˆØ§Ø¬Ø§Ù‹ Ø¹Ø§Ù„Ù…ÙŠØ§Ù‹</h3>
                    </div>
                </div>
                
                <div class="flex overflow-x-auto gap-6 pb-8 custom-h-scroll px-4" id="trendingGrid"></div>
                
                <div class="text-center mt-6">
                    <button onclick="loadTrending(false)" id="moreGlobalBtn" class="bg-slate-800/80 hover:bg-indigo-600 text-slate-300 hover:text-white px-8 py-3 rounded-full text-sm font-bold transition-all border border-slate-600 shadow-lg hover:shadow-glow transform hover:-translate-y-1 backdrop-blur-sm">
                        <i class="fa-solid fa-plus mr-2"></i> Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø²ÙŠØ¯
                    </button>
                </div>
            </section>
        </div>

        <div id="resultsArea" class="hidden animate-slide-up">
            <div class="flex items-center justify-between mb-8 border-b border-slate-700/50 pb-6">
                <h3 class="text-2xl font-bold flex items-center gap-3 text-indigo-200">
                    <i class="fa-solid fa-layer-group text-indigo-500"></i> Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«
                </h3>
                <div class="flex gap-3">
                    <button onclick="goHome()" class="text-sm bg-slate-800 hover:bg-slate-700 px-4 py-2 rounded-lg text-slate-300 transition-colors border border-slate-700">
                        <i class="fa-solid fa-house ml-2"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                    </button>
                    <span id="resultCountBadge" class="bg-indigo-900/40 text-sm px-4 py-2 rounded-lg text-indigo-300 border border-indigo-500/30 font-mono">0</span>
                </div>
            </div>
            
            <div id="resultsGrid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-8 gap-y-14 justify-items-center"></div>

            <div id="loadMoreSearchContainer" class="text-center mt-12 hidden">
                <button onclick="searchBooks(false)" id="moreSearchBtn" class="bg-slate-800/80 hover:bg-indigo-600 text-slate-300 hover:text-white px-8 py-3 rounded-full text-sm font-bold transition-all border border-slate-600 shadow-lg hover:shadow-glow transform hover:-translate-y-1">
                    <i class="fa-solid fa-plus mr-2"></i> Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø²ÙŠØ¯
                </button>
            </div>
            
            <div id="loadingState" class="hidden py-32 text-center">
                <div class="relative w-20 h-20 mx-auto mb-6">
                    <div class="absolute inset-0 border-4 border-indigo-500/20 rounded-full"></div>
                    <div class="absolute inset-0 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin"></div>
                </div>
                <p class="text-slate-400 animate-pulse text-lg">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø±ÙÙˆÙ Ø§Ù„Ù…Ø¹Ø±ÙØ©...</p>
            </div>
            
            <div id="emptySearchState" class="hidden py-32 text-center animate-fade-in">
                <div class="inline-block p-6 bg-slate-800/50 rounded-full mb-6 border border-slate-700">
                    <i class="fa-solid fa-wind text-5xl text-slate-500 animate-float"></i>
                </div>
                <p class="text-slate-200 font-bold text-xl mb-2">Ù„Ù… Ù†Ø¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø©</p>
                <p class="text-slate-500">Ø¬Ø±Ø¨ Ø§Ù„Ø¨Ø­Ø« Ø¨ÙƒÙ„Ù…Ø§Øª Ø¹Ø§Ù…Ø© Ø£ÙƒØ«Ø±ØŒ Ø£Ùˆ ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¥Ù…Ù„Ø§Ø¡.</p>
            </div>
        </div>
    </main>

    <!-- Sidebar with Reading Timer, Challenge & Badges -->
    <aside id="myShelf" class="fixed left-0 top-0 h-[100dvh] w-full sm:w-[420px] bg-slate-900/95 backdrop-blur-2xl border-r border-slate-700/50 transform -translate-x-full transition-transform duration-500 z-[60] shadow-2xl flex flex-col overflow-hidden">
        <div class="p-6 border-b border-slate-700/50 bg-gradient-to-r from-slate-900/80 to-slate-800/50 flex justify-between items-center">
            <h3 class="text-2xl font-heading font-bold text-transparent bg-clip-text bg-gradient-to-r from-pink-400 to-purple-400 drop-shadow-sm">
                <i class="fa-solid fa-heart mr-2 text-pink-500 drop-shadow-glow-pink"></i> ÙƒØªØ¨ÙŠ Ø§Ù„Ù…ÙØ¶Ù„Ø©
            </h3>
            
            <div class="flex gap-2">
                <!-- Ø²Ø± ÙˆØ¶Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ² Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ø¹Ø±Ø¶ Ø§Ù„ÙƒØªØ¨ ÙÙ‚Ø·) -->
                <button onclick="toggleShelfFocus()" id="shelfFocusBtn" class="w-9 h-9 rounded-full bg-slate-800 hover:bg-yellow-600 hover:text-white text-yellow-500 transition-colors border border-slate-600 shadow-md" title="ÙˆØ¶Ø¹ Ø§Ù„ÙƒØªØ¨ ÙÙ‚Ø·">
                    <i class="fa-solid fa-layer-group"></i>
                </button>

                <!-- Share Button -->
                <button id="shareLibBtn" onclick="shareMyLibrary()" class="w-9 h-9 rounded-full bg-slate-800 hover:bg-green-600 hover:text-white text-green-400 transition-colors border border-slate-600 shadow-md" title="Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…ÙƒØªØ¨Ø©">
                    <i class="fa-solid fa-share-nodes"></i>
                </button>
                
                <button onclick="showStatsModal()" class="w-9 h-9 rounded-full bg-slate-800 hover:bg-indigo-500 hover:text-white text-indigo-400 transition-colors border border-slate-600 shadow-md" title="Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©">
                    <i class="fa-solid fa-chart-pie"></i>
                </button>
                
                <button id="expandShelfBtn" onclick="toggleShelfView()" class="w-9 h-9 rounded-full bg-slate-800 hover:bg-slate-700 hover:text-white text-slate-300 transition-colors border border-slate-600 shadow-md" title="ØªÙƒØ¨ÙŠØ± Ø§Ù„Ø¹Ø±Ø¶">
                    <i class="fa-solid fa-expand"></i>
                </button>
                <button onclick="toggleShelf()" class="w-9 h-9 rounded-full bg-slate-800 hover:bg-red-500 hover:text-white text-slate-400 transition-colors border border-slate-600 shadow-md">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
        </div>
        
        <!-- Timer -->
        <div id="panel-timer" class="shelf-section p-5 bg-slate-800/40 border-b border-slate-700/50">
            <div class="flex items-center justify-between mb-3">
                <span class="text-sm font-bold text-slate-300 flex items-center gap-2"><i class="fa-solid fa-stopwatch text-indigo-400"></i> Ù…Ø¤Ù‚Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</span>
                <span id="timerDisplay" class="text-2xl font-mono font-bold text-white tracking-widest bg-black/30 px-3 py-1 rounded-lg border border-white/5">00:00</span>
            </div>
            <button id="timerBtn" onclick="toggleTimer()" class="w-full py-2.5 rounded-xl text-sm font-bold bg-indigo-600 hover:bg-indigo-700 text-white transition-all flex items-center justify-center gap-2 shadow-lg shadow-indigo-900/20 active:scale-95">
                <i class="fa-solid fa-play"></i> Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¬Ù„Ø³Ø©
            </button>
        </div>

        <!-- Badges Section (Enhanced) -->
        <div id="panel-badges" class="shelf-section p-5 border-b border-slate-700/50 bg-slate-900/60">
            <span class="text-sm font-bold text-slate-300 block mb-4 flex items-center gap-2"><i class="fa-solid fa-medal text-yellow-400"></i> Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª</span>
            <div class="grid grid-cols-4 gap-2 px-1" id="badgesContainer">
                <!-- Badges injected by JS -->
            </div>
        </div>

        <!-- Random Book Suggestion -->
        <div id="panel-random" class="shelf-section p-4 bg-slate-800/40 border-b border-slate-700/50">
            <button onclick="pickRandomBook()" class="w-full py-2.5 border border-slate-600 rounded-xl text-xs text-slate-300 hover:text-white hover:bg-slate-700 transition-colors flex items-center justify-center gap-2 group shadow-sm">
                <i class="fa-solid fa-shuffle text-indigo-400 group-hover:rotate-180 transition-transform duration-500"></i> Ø§Ù‚ØªØ±Ø­ Ù„ÙŠ ÙƒØªØ§Ø¨Ø§Ù‹ Ù…Ù† Ø±ÙÙŠ
            </button>
        </div>

        <div id="panel-challenge" class="shelf-section p-5 bg-gradient-to-r from-indigo-900/40 to-purple-900/40 border-b border-slate-700/50">
            <div class="flex justify-between items-center mb-2">
                <span class="text-sm font-bold text-indigo-200">ØªØ­Ø¯ÙŠ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</span>
                <span class="text-[10px] text-indigo-300 font-mono bg-indigo-900/50 px-2 py-0.5 rounded" id="challengeCount">0 / 20 ÙƒØªØ§Ø¨</span>
            </div>
            <div class="w-full bg-slate-800/80 rounded-full h-3 shadow-inner border border-slate-700/50 overflow-hidden">
                <div id="challengeBar" class="bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 h-3 rounded-full transition-all duration-1000 relative shadow-glow" style="width: 0%">
                    <div class="absolute right-0 top-0 h-full w-full bg-white/20 animate-shimmer" style="background-image: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent);"></div>
                </div>
            </div>
        </div>

        <div id="panel-status" class="shelf-section px-5 py-3 bg-slate-800/40 border-b border-slate-700/50">
            <p id="shelfStatusText" class="text-xs text-center text-indigo-300 font-medium">Ù…ÙƒØªØ¨ØªÙƒ Ù…Ø§ Ø²Ø§Ù„Øª ØµØºÙŠØ±Ø©ØŒ Ø£Ø¶Ù Ø§Ù„Ù…Ø²ÙŠØ¯!</p>
        </div>

        <!-- ØªÙ… Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù€ padding-bottom Ù‡Ù†Ø§ (pb-32) Ù„Ù…Ù†Ø¹ Ø§Ø®ØªÙØ§Ø¡ Ø§Ù„ÙƒØªØ¨ Ø®Ù„Ù Ø§Ù„Ø­ÙˆØ§Ù -->
        <div class="flex-grow overflow-y-auto p-5 pb-32 custom-scrollbar bg-slate-900/30" id="shelfContent"></div>
        <div id="shelfFade" aria-hidden="true"></div>
        <div id="shelfScrollHint" class="text-xs text-slate-400 text-center py-2">Ù…Ø±Ù‘Ø± Ù„Ø£Ø³ÙÙ„ Ù„Ø¹Ø±Ø¶ Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙƒØªØ¨ â¬‡ï¸</div>
    </aside>

    <div id="overlay" onclick="toggleShelf()" class="fixed inset-0 bg-slate-900/80 backdrop-blur-sm z-50 hidden opacity-0 transition-opacity duration-500"></div>

    <button id="scrollTopBtn" onclick="window.scrollTo({top: 0, behavior: 'smooth'})" class="fixed bottom-8 right-8 z-40 bg-gradient-to-br from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 text-white w-14 h-14 rounded-full shadow-2xl shadow-indigo-500/40 flex items-center justify-center transition-transform hover:scale-110 border border-white/10 group">
        <i class="fa-solid fa-arrow-up group-hover:-translate-y-1 transition-transform"></i>
    </button>

    <!-- RAWIYA AI Chat Widget (Large Icon) -->
    <div id="rawiyaWidget" class="fixed bottom-8 left-8 z-[100] chat-widget bg-slate-800/90 border border-slate-600/50 shadow-2xl flex flex-col overflow-hidden w-16 h-16 rounded-full hover:scale-105 backdrop-blur-xl transition-all duration-500 shadow-glow-lg">
        <!-- Minimized Button -->
        <button onclick="toggleRawiyaChat()" id="rawiyaTrigger" class="absolute inset-0 w-full h-full flex items-center justify-center bg-gradient-to-br from-pink-500 to-purple-600 text-white z-20 rounded-full transition-opacity shadow-inner group">
            <i class="fa-solid fa-book-reader text-3xl animate-bounce-slight drop-shadow-md"></i>
            <div class="absolute inset-0 rounded-full bg-white/20 animate-pulse-slow"></div>
        </button>

        <!-- Chat Interface -->
        <div id="rawiyaInterface" class="flex flex-col h-full opacity-0 transition-opacity duration-300 pointer-events-none bg-slate-900/95 backdrop-blur-md">
            <!-- Header -->
            <div class="bg-gradient-to-r from-pink-600 to-purple-600 p-4 flex justify-between items-center shrink-0 shadow-lg border-b border-white/10">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center overflow-hidden border-2 border-white/30 p-0.5 shadow-md">
                        <img src="" onerror="this.style.display='none';this.nextElementSibling.style.display='block';" alt="Rawiya" class="w-full h-full object-cover rounded-full bg-pink-100">
                        <i class="fa-solid fa-user-astronaut text-white text-sm hidden"></i>
                    </div>
                    <div>
                        <h4 class="text-base font-bold text-white tracking-wide">Ø±Ø§ÙˆÙŠØ©</h4>
                        <p class="text-[10px] text-pink-100 opacity-90">Ø±ÙÙŠÙ‚Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø°ÙƒÙŠØ©</p>
                    </div>
                </div>
                <button onclick="toggleRawiyaChat()" class="text-white hover:text-pink-200 transition-colors bg-white/10 w-8 h-8 rounded-full flex items-center justify-center hover:bg-white/20"><i class="fa-solid fa-minus"></i></button>
            </div>
            
            <!-- Messages -->
            <div id="chatMessages" class="flex-grow overflow-y-auto p-4 chat-messages space-y-4 bg-slate-900/50">
                <div class="flex gap-3">
                    <div class="w-8 h-8 rounded-full bg-pink-500 flex-shrink-0 flex items-center justify-center text-xs overflow-hidden shadow-md border border-pink-400/50">
                        <i class="fa-solid fa-user-astronaut text-white"></i>
                    </div>
                    <div class="bg-slate-800 p-3 rounded-2xl rounded-tr-none text-sm text-slate-200 border border-slate-700 max-w-[85%] shadow-md leading-relaxed">
                        Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ! Ø£Ù†Ø§ "Ø±Ø§ÙˆÙŠØ©"ØŒ ØµØ¯ÙŠÙ‚ØªÙƒ ÙÙŠ Ø±Ø­Ù„Ø© Ø§Ù„ÙƒØªØ¨. Ù‡Ù„ Ù‚Ø±Ø£Øª Ø´ÙŠØ¦Ø§Ù‹ Ù…Ù„Ù‡Ù…Ø§Ù‹ Ø§Ù„ÙŠÙˆÙ…ØŸ ğŸ“šâœ¨
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="p-3 border-t border-slate-700 bg-slate-800/90 shrink-0 backdrop-blur-sm">
                <div class="flex gap-2 overflow-x-auto tag-scroll pb-1">
                    <button onclick="sendQuickMessage('Ø§Ù‚ØªØ±Ø­ÙŠ Ù„ÙŠ Ø±ÙˆØ§ÙŠØ© Ù‚ØµÙŠØ±Ø©')" class="flex-shrink-0 bg-slate-700 hover:bg-indigo-600 text-slate-300 hover:text-white text-[10px] px-3 py-1.5 rounded-full transition-all border border-slate-600 shadow-sm">Ø§Ù‚ØªØ±Ø§Ø­ Ø±ÙˆØ§ÙŠØ©</button>
                    <button onclick="sendQuickMessage('Ù†ØµÙŠØ­Ø© Ù„Ù„Ù‚Ø±Ø§Ø¡Ø©')" class="flex-shrink-0 bg-slate-700 hover:bg-indigo-600 text-slate-300 hover:text-white text-[10px] px-3 py-1.5 rounded-full transition-all border border-slate-600 shadow-sm">Ù†ØµÙŠØ­Ø©</button>
                    <button onclick="sendQuickMessage('Ø§Ù‚ØªØ¨Ø§Ø³ Ù…Ù„Ù‡Ù…')" class="flex-shrink-0 bg-slate-700 hover:bg-indigo-600 text-slate-300 hover:text-white text-[10px] px-3 py-1.5 rounded-full transition-all border border-slate-600 shadow-sm">Ø§Ù‚ØªØ¨Ø§Ø³</button>
                </div>
            </div>

            <!-- Input Area -->
            <div class="p-3 bg-slate-800 shrink-0 flex gap-2 items-center border-t border-slate-700">
                <input type="text" id="chatInput" class="flex-1 bg-slate-900 border border-slate-600 rounded-full px-4 py-2.5 text-sm text-white focus:border-pink-500 focus:ring-1 focus:ring-pink-500/50 focus:outline-none placeholder-slate-500 transition-all" placeholder="Ø§ÙƒØªØ¨ Ù„Ø±Ø§ÙˆÙŠØ©..." onkeypress="if(event.key === 'Enter') sendMessage()">
                <button onclick="sendMessage()" class="bg-gradient-to-r from-pink-600 to-purple-600 w-10 h-10 rounded-full flex items-center justify-center text-white shadow-lg hover:scale-110 transition-transform hover:shadow-pink-500/30">
                    <i class="fa-solid fa-paper-plane text-sm"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Share Link Modal -->
    <div id="shareModal" class="fixed inset-0 z-[210] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-900/90 backdrop-blur-sm transition-opacity" onclick="closeShareModal()"></div>
        <div class="relative bg-slate-800 w-full max-w-md rounded-3xl shadow-2xl p-8 border border-slate-600 animate-pop bg-gradient-to-b from-slate-800 to-slate-900 overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500"></div>
            
            <div class="w-16 h-16 bg-indigo-500/20 rounded-full flex items-center justify-center mx-auto mb-6 border border-indigo-500/30 shadow-glow">
                <i class="fa-solid fa-link text-2xl text-indigo-400"></i>
            </div>
            
            <h3 class="text-2xl font-bold text-white mb-2 text-center">Ø´Ø§Ø±Ùƒ Ø´ØºÙÙƒ</h3>
            <p class="text-xs text-slate-400 text-center mb-6 px-4">Ø§Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· Ø£Ø¯Ù†Ø§Ù‡ Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ù…ÙƒØªØ¨ØªÙƒ Ù…Ø¹ Ø£ØµØ¯Ù‚Ø§Ø¦Ùƒ. Ø³ÙŠØªÙ…ÙƒÙ†ÙˆÙ† Ù…Ù† Ø±Ø¤ÙŠØ© ÙƒØªØ¨Ùƒ ÙˆØ­Ø§Ù„Ø© Ù‚Ø±Ø§Ø¡ØªÙƒ.</p>
            
            <div class="bg-slate-900 p-4 rounded-xl border border-slate-700 mb-6 flex items-center gap-3 shadow-inner relative group">
                <input type="text" id="shareLinkInput" class="bg-transparent w-full text-xs text-indigo-300 focus:outline-none font-mono" readonly>
                <div class="absolute inset-0 bg-indigo-500/5 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none rounded-xl"></div>
            </div>
            
            <div class="flex gap-3">
                <button onclick="copyShareLink()" class="flex-[2] py-3 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl text-sm font-bold transition-all shadow-lg shadow-indigo-500/20 hover:scale-[1.02] flex items-center justify-center gap-2">
                    <i class="fa-regular fa-copy"></i> Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·
                </button>
                <button onclick="closeShareModal()" class="flex-1 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-xl text-sm font-bold transition-colors">Ø¥ØºÙ„Ø§Ù‚</button>
            </div>
        </div>
    </div>

    <!-- Achievement Celebration Modal (New) -->
    <div id="achievementModal" class="fixed inset-0 z-[300] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/90 backdrop-blur-md" onclick="closeAchievementModal()"></div>
        <!-- Confetti Container -->
        <div id="confettiContainer" class="absolute inset-0 pointer-events-none overflow-hidden"></div>
        
        <div class="relative bg-slate-800 w-full max-w-sm rounded-3xl shadow-2xl p-8 border border-yellow-500/50 animate-pop text-center z-10 bg-gradient-to-b from-slate-800 to-slate-900">
            <div class="w-24 h-24 bg-yellow-500/20 rounded-full flex items-center justify-center mx-auto mb-6 border border-yellow-500/50 shadow-[0_0_30px_rgba(234,179,8,0.4)] relative">
                <i class="fa-solid fa-trophy text-5xl text-yellow-400 animate-bounce"></i>
                <div class="absolute inset-0 bg-yellow-400 blur-xl opacity-30 rounded-full animate-pulse"></div>
            </div>
            
            <h2 class="text-3xl font-bold text-white mb-2">Ù…Ø¨Ø±ÙˆÙƒ! ğŸ‰</h2>
            <p class="text-yellow-400 font-bold text-lg mb-4" id="achievementTitle">Ø§Ø³Ù… Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</p>
            <p class="text-slate-300 text-sm mb-8 italic" id="achievementQuote">"ÙƒÙ„ ÙƒØªØ§Ø¨ ØªÙ‚Ø±Ø£Ù‡ ÙŠØ¶ÙŠÙ Ù„Ø¹Ù…Ø±Ùƒ Ø¹Ù…Ø±Ø§Ù‹ Ø¬Ø¯ÙŠØ¯Ø§Ù‹."</p>
            
            <button onclick="closeAchievementModal()" class="w-full py-3 bg-gradient-to-r from-yellow-600 to-orange-600 hover:from-yellow-500 hover:to-orange-500 text-white rounded-xl font-bold shadow-lg transform hover:scale-105 transition-all">
                Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„ØªØ£Ù„Ù‚!
            </button>
        </div>
    </div>

    <!-- Shared Shelf Modal -->
    <div id="sharedShelfModal" class="fixed inset-0 z-[220] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-900/90 backdrop-blur-md" onclick="document.getElementById('sharedShelfModal').classList.add('hidden')"></div>
        <div class="relative bg-slate-800 w-full max-w-4xl rounded-3xl shadow-2xl p-0 border border-slate-600 animate-slide-up flex flex-col max-h-[85vh] overflow-hidden">
            <div class="p-6 bg-slate-900/50 border-b border-slate-700 flex justify-between items-center">
                <h3 class="text-2xl font-bold text-white flex items-center gap-3">
                    <div class="bg-green-500/20 p-2.5 rounded-xl border border-green-500/20"><i class="fa-solid fa-share-nodes text-green-400"></i></div>
                    <div class="flex flex-col">
                        <span class="text-xs text-slate-400 font-normal">Ù…ÙƒØªØ¨Ø© Ù…Ø´Ø§Ø±ÙƒØ© Ù…Ù†</span>
                        <span class="text-indigo-400" id="sharedOwnerName"></span>
                    </div>
                </h3>
                <button onclick="document.getElementById('sharedShelfModal').classList.add('hidden')" class="w-8 h-8 rounded-full bg-slate-700 hover:bg-red-500/20 text-slate-400 hover:text-red-400 flex items-center justify-center transition-all">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            
            <div class="overflow-y-auto custom-scrollbar flex-grow p-6 bg-slate-800/50">
                <div id="sharedGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-5">
                    <!-- Shared items populated here -->
                </div>
            </div>
            
            <div class="p-4 bg-slate-900 border-t border-slate-700 text-center">
                <p class="text-[11px] text-slate-400"><i class="fa-solid fa-circle-info mr-1 text-indigo-400"></i> Ø§Ø¶ØºØ· "Ø¥Ø¶Ø§ÙØ©" Ù„Ù†Ø³Ø® Ø§Ù„ÙƒØªØ§Ø¨ Ø¥Ù„Ù‰ Ø±ÙÙƒ (Ø³ÙŠØªÙ… ØªØ¹ÙŠÙŠÙ†Ù‡ ÙƒÙ€ "Ù„Ù… Ø£Ø¨Ø¯Ø£" Ù„ØªØ¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ Ø§Ù„Ø®Ø§ØµØ©).</p>
            </div>
        </div>
    </div>

    <!-- Stats Modal -->
    <div id="statsModal" class="fixed inset-0 z-[200] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-900/90 backdrop-blur-sm" onclick="closeStatsModal()"></div>
        <div class="relative bg-slate-800 w-full max-w-sm rounded-3xl shadow-2xl p-8 border border-slate-600 animate-pop text-center overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-full opacity-10 pointer-events-none bg-[url('https://www.transparenttextures.com/patterns/stardust.png')]"></div>
            
            <div class="w-20 h-20 bg-green-500/10 rounded-full flex items-center justify-center mx-auto mb-6 border border-green-500/30 shadow-glow">
                <i class="fa-solid fa-trophy text-4xl text-green-400 animate-bounce"></i>
            </div>
            
            <h3 class="text-2xl font-bold text-white mb-8">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¨Ø§Ø­Ø«</h3>
            
            <div class="grid grid-cols-2 gap-4 mb-8">
                <div class="bg-slate-900/60 p-4 rounded-2xl border border-slate-700/50 hover:border-indigo-500/50 transition-colors">
                    <p class="text-xs text-slate-400 mb-1">ÙƒØªØ¨ ÙÙŠ Ù…ÙƒØªØ¨ØªÙƒ</p>
                    <p id="statsTotalBooks" class="text-3xl font-bold text-indigo-400">0</p>
                </div>
                <div class="bg-slate-900/60 p-4 rounded-2xl border border-slate-700/50 hover:border-pink-500/50 transition-colors">
                    <p class="text-xs text-slate-400 mb-1">ØµÙØ­Ø§Øª Ø§Ù„Ù…Ø¹Ø±ÙØ©</p>
                    <p id="statsTotalPages" class="text-3xl font-bold text-pink-400">0</p>
                </div>
            </div>

            <div class="bg-indigo-500/10 border border-indigo-500/20 rounded-xl p-4 text-xs text-indigo-200 mb-6 leading-relaxed" id="statsMessage">
                Ø£Ø±Ù‚Ø§Ù… Ø±Ø§Ø¦Ø¹Ø©! ÙƒÙ„ ØµÙØ­Ø© ØªÙ‚Ø±Ø£Ù‡Ø§ ØªØ¶ÙŠÙ Ù„Ø¹Ù‚Ù„Ùƒ Ø¨ÙØ¹Ø¯Ø§Ù‹ Ø¬Ø¯ÙŠØ¯Ø§Ù‹.
            </div>

            <button onclick="closeStatsModal()" class="w-full py-3 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl transition-all font-bold shadow-lg shadow-indigo-500/20 hover:scale-[1.02]">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
        </div>
    </div>

    <!-- Name Input Modal -->
    <div id="nameModal" class="fixed inset-0 z-[200] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/95 backdrop-blur-xl"></div>
        <div class="relative bg-slate-800 w-full max-w-md rounded-3xl shadow-2xl p-10 border border-slate-600 text-center animate-slide-up">
            <div class="w-24 h-24 bg-indigo-500/20 rounded-full flex items-center justify-center mx-auto mb-8 shadow-glow border border-indigo-500/30">
                <i class="fa-solid fa-user-astronaut text-5xl text-indigo-400 animate-bounce"></i>
            </div>
            <h2 class="text-3xl font-bold text-white mb-3">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø¹Ø§Ù„Ù… Ø§Ù„Ù…Ø¹Ø±ÙØ©</h2>
            <p class="text-slate-400 mb-8 text-sm leading-relaxed">Ù„Ù†Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ Ø§Ù„Ù…Ø®ØµØµØ© ÙÙŠ Ø§ÙƒØªØ´Ø§Ù Ø§Ù„ÙƒØªØ¨.<br>Ø£Ø®Ø¨Ø±Ù†Ø§ØŒ Ù…Ø§ Ù‡Ùˆ Ø§Ø³Ù…ÙƒØŸ</p>
            
            <input type="text" id="userNameInput" class="w-full bg-slate-900 border border-slate-600 rounded-xl px-5 py-4 text-center text-white mb-6 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 outline-none placeholder-slate-600 transition-all text-lg shadow-inner" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§...">
            
            <button onclick="saveUserName()" class="w-full py-4 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 text-white font-bold rounded-xl transition-all transform hover:scale-[1.02] shadow-xl shadow-indigo-500/30 text-lg">
                Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙŠ <i class="fa-solid fa-rocket mr-2"></i>
            </button>
        </div>
    </div>

    <!-- Settings Modal (Updated with Name Change) -->
    <div id="settingsModal" class="fixed inset-0 z-[200] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-900/90 backdrop-blur-sm" onclick="closeSettingsModal()"></div>
        <div class="relative bg-slate-800 w-full max-w-sm rounded-3xl shadow-2xl p-8 border border-slate-600 animate-pop">
            <h3 class="text-2xl font-bold text-white mb-6 flex items-center gap-3 border-b border-slate-700 pb-4">
                <i class="fa-solid fa-sliders text-indigo-400"></i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            </h3>
            
            <div class="space-y-5">
                <!-- Name Change Section -->
                <div class="bg-slate-900/50 p-4 rounded-xl border border-slate-700/50">
                    <h4 class="text-sm font-bold text-slate-300 mb-3">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</h4>
                    <div class="flex gap-2">
                        <input type="text" id="settingsNameInput" class="flex-1 bg-slate-800 border border-slate-600 rounded-lg px-3 py-2 text-sm text-white focus:border-indigo-500 focus:outline-none" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯">
                        <button onclick="updateNameFromSettings()" class="bg-indigo-600 hover:bg-indigo-500 text-white px-4 py-2 rounded-lg text-sm font-bold transition-colors">Ø­ÙØ¸</button>
                    </div>
                </div>

                <div class="bg-slate-900/50 p-4 rounded-xl border border-slate-700/50">
                    <h4 class="text-sm font-bold text-slate-300 mb-3">Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ</h4>
                    <div class="flex gap-3">
                        <button onclick="exportLibrary()" class="flex-1 py-2.5 bg-indigo-600 hover:bg-indigo-500 text-white text-xs rounded-lg transition-colors font-bold shadow-lg shadow-indigo-500/20">
                            <i class="fa-solid fa-download mb-1 block text-base"></i> ØªØµØ¯ÙŠØ±
                        </button>
                        <button onclick="document.getElementById('importFile').click()" class="flex-1 py-2.5 bg-slate-700 hover:bg-slate-600 text-white text-xs rounded-lg transition-colors font-bold shadow-md">
                            <i class="fa-solid fa-upload mb-1 block text-base"></i> Ø§Ø³ØªØ¹Ø§Ø¯Ø©
                        </button>
                        <input type="file" id="importFile" class="hidden" accept=".json" onchange="importLibrary(this)">
                    </div>
                    <p class="text-[10px] text-slate-500 mt-2 text-center">Ø§Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ÙÙŠ Ù…Ù„Ù Ø¢Ù…Ù†.</p>
                </div>

                <div class="bg-slate-900/50 p-4 rounded-xl border border-slate-700/50">
                    <h4 class="text-sm font-bold text-slate-300 mb-3">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h4>
                    <button onclick="resetData()" class="w-full py-2.5 bg-red-500/10 hover:bg-red-500/20 text-red-400 border border-red-500/30 text-xs rounded-lg transition-colors flex items-center justify-center gap-2">
                        <i class="fa-solid fa-trash-can"></i> Ù…Ø³Ø­ ÙƒØ§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    </button>
                </div>
            </div>

            <button onclick="closeSettingsModal()" class="w-full mt-6 py-3 text-slate-400 hover:text-white text-sm font-bold bg-slate-700/30 hover:bg-slate-700/50 rounded-xl transition-colors">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>
    
    <!-- Book Details Modal -->
    <div id="bookModal" class="fixed inset-0 z-[150] hidden flex items-center justify-center p-4 transition-opacity duration-300 opacity-0">
        <!-- Backdrop -->
        <div class="absolute inset-0 bg-slate-900/90 backdrop-blur-xl" onclick="closeModal()"></div>
        
        <!-- Modal Content -->
        <div id="modalContent" class="relative bg-slate-800 w-full max-w-5xl rounded-3xl shadow-2xl overflow-hidden flex flex-col md:flex-row max-h-[90vh] border border-slate-600/50 transform scale-95 transition-transform duration-300">
            <!-- Close Button -->
            <button onclick="closeModal()" class="absolute top-5 right-5 z-20 w-10 h-10 rounded-full bg-black/40 hover:bg-black/70 text-white flex items-center justify-center transition-all backdrop-blur-md border border-white/10">
                <i class="fa-solid fa-xmark text-lg"></i>
            </button>

            <!-- Left: Image Blur Background -->
            <div class="w-full md:w-5/12 relative h-72 md:h-auto flex-shrink-0 overflow-hidden group">
                <img id="modalBlurBg" src="" class="absolute inset-0 w-full h-full object-cover blur-2xl opacity-60 scale-125 transition-transform duration-1000 group-hover:scale-150">
                <div class="absolute inset-0 bg-gradient-to-t from-slate-900 via-slate-900/20 to-transparent"></div>
                <div class="relative z-10 w-full h-full flex items-center justify-center p-8">
                    <img id="modalImg" src="" class="w-48 md:w-64 shadow-[0_30px_60px_rgba(0,0,0,0.6)] rounded-lg transform group-hover:scale-105 transition-transform duration-500 border border-white/10 rotate-1">
                </div>
            </div>

            <!-- Right: Details -->
            <div class="w-full md:w-7/12 p-8 md:p-10 overflow-y-auto custom-scrollbar flex flex-col bg-gradient-to-b from-slate-800 to-slate-900">
                <div class="mb-8">
                    <div class="flex flex-wrap gap-2 mb-4">
                        <span id="modalGenre" class="text-[11px] bg-indigo-500/20 text-indigo-300 px-3 py-1 rounded-full border border-indigo-500/30 font-bold uppercase tracking-wider"></span>
                        <span id="modalLangBadge" class="text-[11px] bg-slate-700/50 text-slate-300 px-3 py-1 rounded-full border border-slate-600 font-bold"></span>
                    </div>
                    <h2 id="modalTitle" class="text-3xl md:text-4xl font-heading font-bold text-white leading-tight mb-2 drop-shadow-sm"></h2>
                    <p id="modalAuthors" class="text-indigo-400 font-medium text-base mb-6 flex items-center gap-2"><i class="fa-solid fa-pen-nib text-xs"></i> <span></span></p>
                    
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-xs text-slate-400 mb-6 border-y border-slate-700/50 py-4">
                        <span class="flex flex-col gap-1"><span class="text-slate-500 font-bold">Ø§Ù„Ù†Ø´Ø±</span> <span id="modalYearBadge" class="text-slate-200"></span></span>
                        <span class="flex flex-col gap-1"><span class="text-slate-500 font-bold">Ø§Ù„ØµÙØ­Ø§Øª</span> <span id="modalPageBadge" class="text-slate-200"></span></span>
                        <span class="flex flex-col gap-1"><span class="text-slate-500 font-bold">Ø§Ù„Ù…Ø³ØªÙˆÙ‰</span> <span id="modalDifficulty" class="text-slate-200"></span></span>
                        <div id="modalRating" class="flex flex-col gap-1 justify-center"></div>
                    </div>

                    <div class="prose prose-invert prose-sm max-w-none mb-6">
                        <p id="modalDesc" class="text-slate-300 leading-relaxed text-sm line-clamp-5"></p>
                    </div>

                    <button onclick="toggleMoreInfo()" class="text-xs text-indigo-400 hover:text-indigo-300 flex items-center gap-2 mb-4 font-bold bg-indigo-500/10 px-4 py-2 rounded-lg w-fit transition-colors">
                        <span id="moreInfoText">Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ©</span>
                        <i id="moreInfoIcon" class="fa-solid fa-chevron-down"></i>
                    </button>
                    
                    <div id="moreInfoContent" class="hidden grid grid-cols-2 gap-3 text-xs text-slate-300 bg-slate-800/80 p-4 rounded-xl mb-6 animate-fade-in border border-slate-700 shadow-inner">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <!-- Action Area -->
                <div class="mt-auto bg-slate-800/60 rounded-2xl p-6 border border-slate-700 shadow-lg">
                    <!-- Status Section (Only for Saved Books) -->
                    <div id="readingStatusContainer" class="mb-6 hidden animate-fade-in">
                        <p class="text-xs font-bold text-slate-400 mb-3 uppercase tracking-wide">Ø­Ø§Ù„Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</p>
                        <div class="flex gap-3 mb-4">
                            <div class="flex-1">
                                <input type="radio" name="status" id="status-unread" value="unread" class="hidden status-radio" onchange="updateBookStatus('unread')">
                                <label for="status-unread" class="flex flex-col items-center justify-center py-2.5 rounded-xl border border-slate-600 text-slate-500 text-xs cursor-pointer hover:bg-slate-700 transition-all h-full"><i class="fa-solid fa-bookmark mb-1 text-lg"></i> Ù„Ù… Ø£Ø¨Ø¯Ø£</label>
                            </div>
                            <div class="flex-1">
                                <input type="radio" name="status" id="status-reading" value="reading" class="hidden status-radio" onchange="updateBookStatus('reading')">
                                <label for="status-reading" class="flex flex-col items-center justify-center py-2.5 rounded-xl border border-slate-600 text-slate-500 text-xs cursor-pointer hover:bg-slate-700 transition-all h-full"><i class="fa-solid fa-book-open mb-1 text-lg"></i> Ø£Ù‚Ø±Ø£ Ø­Ø§Ù„ÙŠØ§Ù‹</label>
                            </div>
                            <div class="flex-1">
                                <input type="radio" name="status" id="status-finished" value="finished" class="hidden status-radio" onchange="updateBookStatus('finished')">
                                <label for="status-finished" class="flex flex-col items-center justify-center py-2.5 rounded-xl border border-slate-600 text-slate-500 text-xs cursor-pointer hover:bg-slate-700 transition-all h-full"><i class="fa-solid fa-check-circle mb-1 text-lg"></i> Ø£ÙƒÙ…Ù„ØªÙ‡</label>
                            </div>
                        </div>

                        <!-- Progress Slider -->
                        <div id="progressContainer" class="hidden animate-fade-in bg-slate-900/50 p-3 rounded-xl border border-slate-700/50">
                            <div class="flex justify-between text-xs text-slate-400 mb-2">
                                <span class="font-bold">Ù†Ø³Ø¨Ø© Ø§Ù„ØªÙ‚Ø¯Ù…</span>
                                <span id="progressValue" class="text-indigo-400 font-bold bg-indigo-900/30 px-2 rounded">0%</span>
                            </div>
                            <input type="range" id="readingProgress" min="0" max="100" value="0" oninput="updateProgress(this.value)">
                        </div>
                    </div>

                    <!-- Notes Section -->
                    <div class="mb-5">
                        <textarea id="bookNotes" class="w-full bg-slate-900/80 border border-slate-600 rounded-xl p-4 text-sm text-white focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 outline-none resize-none h-24 placeholder-slate-500 shadow-inner transition-all" placeholder="Ø¯ÙˆÙ† Ø£ÙÙƒØ§Ø±Ùƒ ÙˆÙ…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ø­ÙˆÙ„ Ø§Ù„ÙƒØªØ§Ø¨ Ù‡Ù†Ø§..."></textarea>
                    </div>

                    <div class="flex gap-3">
                        <button id="modalShelfBtn" class="flex-[2] py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl text-sm font-bold shadow-lg shadow-indigo-500/20 transition-all flex items-center justify-center gap-2 hover:scale-[1.02]">
                            <!-- Populated by JS -->
                        </button>
                        <a id="modalPreviewLink" target="_blank" class="flex-1 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-xl text-sm font-bold transition-all flex items-center justify-center gap-2 hover:bg-slate-500 shadow-md">
                            <i class="fa-brands fa-google"></i> Ù…Ø¹Ø§ÙŠÙ†Ø©
                        </a>
                        <button onclick="shareBook()" class="w-12 bg-slate-700 hover:bg-slate-600 text-white rounded-xl flex items-center justify-center transition-colors shadow-md text-lg">
                            <i class="fa-solid fa-share-nodes"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Toast Notification -->
    <div id="toast" class="fixed bottom-10 left-1/2 transform -translate-x-1/2 bg-slate-800 border border-slate-600 shadow-2xl rounded-full pl-6 pr-2 py-2 flex items-center gap-3 transition-all duration-500 translate-y-24 opacity-0 z-[250] shadow-glow">
        <div id="toastIconWrapper" class="bg-green-500/20 p-2 rounded-full text-green-500 transition-transform duration-300">
            <i id="toastIcon" class="fa-solid fa-check"></i>
        </div>
        <div>
            <h4 id="toastTitle" class="text-xs font-bold text-white">Ù†Ø¬Ø§Ø­</h4>
            <p id="toastMsg" class="text-[10px] text-slate-400">ØªÙ…Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­</p>
        </div>
    </div>

    <!-- Footer -->
    <!-- Developer / About Section (simplified responsive layout) -->
    <section id="developerSection" class="mt-12" aria-labelledby="devHeading">
        <style>
            /* Simplified developer section styles for better responsiveness */
            #developerSection { --bg-1: linear-gradient(135deg,#060617 0%, #071029 100%); --accent-a:#7c3aed; --accent-b:#06b6d4; background:var(--bg-1); padding:36px 0; }
            #developerSection .dev-wrap { max-width:1100px; margin:0 auto; padding:20px; display:flex; gap:20px; align-items:center; justify-content:space-between; color:#cbd5e1 }
            #developerSection .dev-card { background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border:1px solid rgba(255,255,255,0.04); padding:20px; border-radius:14px; backdrop-filter: blur(8px); box-shadow: 0 6px 30px rgba(2,6,23,0.6); display:flex; gap:18px; align-items:center }
            .dev-profile { width:140px; height:140px; display:flex; align-items:center; justify-content:center; position:relative }
            .dev-profile .avatar { width:120px; height:120px; border-radius:14px; background-image: url('https://via.placeholder.com/300x300?text=ÙŠÙˆØ³Ù'); background-size:cover; background-position:center; box-shadow: 0 6px 30px rgba(124,58,237,0.08); border:3px solid rgba(255,255,255,0.03); transition: transform .25s ease }
            .dev-profile .avatar:hover { transform:scale(1.03) }
            .dev-profile .glow { position:absolute; inset:auto; width:180px; height:180px; border-radius:18px; filter:blur(30px); background: radial-gradient(circle at 30% 20%, rgba(124,58,237,0.12), transparent 30%), radial-gradient(circle at 70% 80%, rgba(6,182,212,0.06), transparent 30%); z-index:-1 }

            .dev-info { flex:1; min-width:220px }
            .dev-info h3 { font-size:1.15rem; color:#fff; margin:0 0 8px 0 }
            .dev-info p { color:#cbd5e1; line-height:1.7; margin:0 }
            .dev-info p .highlight { color:var(--accent-b); font-weight:700 }
            .dev-actions { margin-top:12px; display:flex; gap:12px; align-items:center; flex-wrap:wrap }
            .dev-cta { background: linear-gradient(90deg,var(--accent-a),var(--accent-b)); color:#021026; padding:10px 14px; border-radius:10px; font-weight:700; box-shadow:0 8px 30px rgba(6,182,212,0.05); border:1px solid rgba(255,255,255,0.04); text-decoration:none }

            /* Social row (simple, below bio) */
            .social-row { display:flex; gap:10px; margin-top:12px }
            .social-row a { display:inline-flex; align-items:center; justify-content:center; gap:8px; padding:8px 12px; border-radius:10px; background:rgba(255,255,255,0.02); color:#e6eef8; border:1px solid rgba(255,255,255,0.035); text-decoration:none; font-size:14px }
            .social-row a i { width:18px; text-align:center }

            /* Entrance */
            .dev-card { opacity:0; transform:translateY(14px); transition: opacity .55s ease, transform .55s ease }
            .dev-card.in-view { opacity:1; transform:none }

            /* Responsive adjustments */
            @media (max-width:880px){ #developerSection .dev-wrap{ flex-direction:column; align-items:center } .dev-card{ flex-direction:column; text-align:center; gap:14px } .dev-info{ text-align:center } .dev-profile{ width:120px; height:120px } }
            @media (max-width:420px){ #developerSection{ padding:22px 0 } .dev-profile .avatar{ width:110px; height:110px } .social-row{ justify-content:center; flex-wrap:wrap } }
        </style>

        <div class="container dev-wrap px-4">
            <div class="dev-card" role="region" aria-labelledby="devHeading">
                <div class="dev-profile">
                    <div class="glow" aria-hidden="true"></div>
                    <img class="avatar"  src="mmat/Untitled-1.png" title="ÙŠÙˆØ³Ù Ø£ÙŠÙ…Ù†" role="img" aria-label="ØµÙˆØ±Ø© ÙŠÙˆØ³Ù Ø£ÙŠÙ…Ù†"></img>
                    <img  alt="">
                </div>

                <div class="dev-info">
                    <h3 id="devHeading">ÙŠÙˆØ³Ù Ø£ÙŠÙ…Ù† â€” Ù…Ø·ÙˆØ± ÙˆÙ…ØµÙ…Ù…</h3>
                    <p>
                        Ø£Ù†Ø§ ÙŠÙˆØ³Ù Ø£ÙŠÙ…Ù†ØŒ Ø·Ø§Ù„Ø¨ Ù‡Ù†Ø¯Ø³Ø© Ø¨Ø¬Ø§Ù…Ø¹Ø© Ø·Ù†Ø·Ø§ ÙÙŠ Ù‚Ø³Ù… <span class="highlight">Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ (AI)</span>.
                        Ø£Ø¹Ù…Ù„ ÙƒÙ€ <span class="highlight">Full-stack Web Developer</span>  ,  <span class="highlight">Graphic Designer</span>ØŒ Ù…Ù…Ø§ ÙŠÙ…Ù†Ø­Ù†ÙŠ Ø±Ø¤ÙŠØ© Ø´Ø§Ù…Ù„Ø© Ù„Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ ØªØ¨Ø¯Ø£ Ù…Ù† Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¬Ù…Ø§Ù„ÙŠØŒ Ù…Ø±ÙˆØ±Ø§Ù‹ Ø¨Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„Ù‚ÙˆÙŠØ©ØŒ ÙˆØµÙˆÙ„Ø§Ù‹ Ø¥Ù„Ù‰ Ø¯Ù…Ø¬ Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª <span class="highlight">Ø§Ù„Ø°ÙƒÙŠØ©</span>.
                        ØŒ Ù…Ù…Ø§ ÙŠÙ…Ù†Ø­Ù†ÙŠ Ø±Ø¤ÙŠØ© Ø´Ø§Ù…Ù„Ø© Ù„Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ ØªØ¨Ø¯Ø£ Ù…Ù† Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¬Ù…Ø§Ù„ÙŠØŒ Ù…Ø±ÙˆØ±Ø§Ù‹ Ø¨Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„Ù‚ÙˆÙŠØ©ØŒ ÙˆØµÙˆÙ„Ø§Ù‹ Ø¥Ù„Ù‰ Ø¯Ù…Ø¬ Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª <span class="highlight">Ø§Ù„Ø°ÙƒÙŠØ©</span>.
                    </p>

                    <div class="dev-actions">
                        <a class="dev-cta" href="mailto:engyusufayman@gmail.com" target="_blank" rel="noopener" title="Ø£Ø±Ø³Ù„ Ø±Ø³Ø§Ù„Ø© Ø¥Ù„Ù‰ ÙŠÙˆØ³Ù">ØªÙˆØ§ØµÙ„ Ù…Ø¹ÙŠ</a>
                        <div style="color:#94a3b8;font-size:13px">ØªÙˆØ§ØµÙ„: <span style="color:#fff;font-weight:700">engyusufayman@gmail.com</span></div>
                    </div>

                    <div class="social-row" aria-label="Ø±ÙˆØ§Ø¨Ø· ØªÙˆØ§ØµÙ„">
                        <a href="https://engyusufayman06.github.io/Portfolio" target="_blank" rel="noopener" title="Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø´Ø®ØµÙŠ"><i class="fa-solid fa-globe"></i>Portfolio</a>
                        <a href="https://www.linkedin.com/in/yusuf-ayman-a390b939b" target="_blank" rel="noopener" title="LinkedIn"><i class="fa-brands fa-linkedin-in"></i> LinkedIn</a>
                        <a href="https://www.instagram.com/eng.yusuf.ayman/" target="_blank" rel="noopener" title="Instagram"><i class="fa-brands fa-instagram"></i> Instagram</a>
                        <a href="https://www.facebook.com/eng.yusuf.ayman" target="_blank" rel="noopener" title="Facebook"><i class="fa-brands fa-facebook-f"></i> Facebook</a>
                    </div>
                </div>
            </div>
        </div>

        <script>
            (function(){
                // Entrance observer
                const card = document.querySelector('#developerSection .dev-card');
                if(card){
                    const obs = new IntersectionObserver((entries)=>{
                        entries.forEach(e=>{ if(e.isIntersecting){ card.classList.add('in-view'); obs.unobserve(card); } });
                    },{threshold:0.18});
                    obs.observe(card);
                }

                // Ripple effect for social links (keeps it subtle)
                document.querySelectorAll('#developerSection .social-row a').forEach(a=>{
                    a.addEventListener('click',(ev)=>{
                        const el = document.createElement('span');
                        el.style.position='absolute'; el.style.left='50%'; el.style.top='50%'; el.style.transform='translate(-50%,-50%)';
                        el.style.width='8px'; el.style.height='8px'; el.style.borderRadius='50%'; el.style.background='rgba(255,255,255,0.12)';
                        el.style.pointerEvents='none'; el.style.zIndex='3'; a.style.position='relative'; a.appendChild(el);
                        setTimeout(()=>el.remove(),350);
                    });
                });
            })();
        </script>
    </section>
    <footer class="mt-auto border-t border-slate-800 bg-slate-900/80 py-10 text-center backdrop-blur-sm">
        <div class="container mx-auto px-4">
            <i class="fa-solid fa-book-open text-indigo-500 mb-4 text-3xl animate-book-breath drop-shadow-glow"></i>
            <p class="text-slate-400 text-sm mb-6 max-w-md mx-auto leading-relaxed">Ø±Ø­Ù„Ø© Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø¹Ø±ÙØ© Ù„Ø§ ØªÙ†ØªÙ‡ÙŠ Ø£Ø¨Ø¯Ø§Ù‹. Ù†Ø­Ù† Ù‡Ù†Ø§ Ù„Ù†ÙƒÙˆÙ† Ø±ÙÙŠÙ‚Ùƒ ÙÙŠ ÙƒÙ„ ØµÙØ­Ø©.</p>
            <p class="text-slate-600 text-xs font-mono">Â© 2026 Ù…ÙƒØªØ¨ØªÙŠ ++. ØµÙÙ†Ø¹ Ø¨Ø­Ø¨ ÙˆØ´ØºÙ Ù„Ù„Ù‚Ø±Ø§Ø¡.</p>
        </div>
    </footer>

    <style>
        /* Global badge unlock animations and status-radio checked styles */
        .badge-unlocked { animation: badge-pop .9s ease both; box-shadow: 0 8px 30px rgba(99,102,241,0.12); }
        @keyframes badge-pop { 0%{ transform: scale(.8); opacity: 0 } 60%{ transform: scale(1.08); opacity: 1 } 100%{ transform: scale(1); } }

        /* radio status checked styling for modal status labels */
        .status-radio + label { transition: all .28s ease; }
        .status-radio:checked + label { background: linear-gradient(90deg,#10b981,#06b6d4); color:#021026; border-color: rgba(16,185,129,0.28); box-shadow:0 10px 30px rgba(16,185,129,0.08); transform: translateY(-4px); }
        .status-radio:disabled + label { opacity: .6; pointer-events:none }
    </style>

    <script>
        // --- Core Data ---
        let myLibrary = JSON.parse(localStorage.getItem('myLibrary_Inspire')) || [];
        let searchHistory = JSON.parse(localStorage.getItem('searchHistory_Inspire')) || [];
        let unlockedBadges = JSON.parse(localStorage.getItem('unlockedBadges_Inspire')) || [];
        let currentBooksCache = [];
        let activeBookMoreInfo = {}; 
        
        let trendingStartIndex = 0;
        let searchStartIndex = 0; 

        // --- Config ---
        const badgesData = [
            { id: 'b_starter', icon: 'fa-seedling', title: 'Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø±Ø­Ù„Ø©', desc: 'Ø£Ø¶ÙØª ÙƒØªØ§Ø¨Ùƒ Ø§Ù„Ø£ÙˆÙ„', type: 'add', target: 1 },
            { id: 'b_worm_sm', icon: 'fa-book-open', title: 'Ù‚Ø§Ø±Ø¦ Ù…Ø¨ØªØ¯Ø¦', desc: 'Ø£Ø¶ÙØª 5 ÙƒØªØ¨', type: 'add', target: 5 },
            { id: 'b_worm_md', icon: 'fa-layer-group', title: 'ØµØ¯ÙŠÙ‚ Ø§Ù„ÙƒØªØ¨', desc: 'Ø£Ø¶ÙØª 10 ÙƒØªØ¨', type: 'add', target: 10 },
            { id: 'b_worm_lg', icon: 'fa-award', title: 'Ø£Ù…ÙŠÙ† Ø§Ù„Ù…ÙƒØªØ¨ Ø©', desc: 'Ø£Ø¶ÙØª 20 ÙƒØªØ§Ø¨Ø§Ù‹', type: 'add', target: 20 },
            { id: 'b_worm_xl', icon: 'fa-boxes-stacked', title: 'Ø£Ù…ÙŠÙ† Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„ÙƒØ¨ÙŠØ±', desc: 'Ø£Ø¶ÙØª 50 ÙƒØªØ§Ø¨Ø§Ù‹', type: 'add', target: 50 },
            { id: 'b_worm_legacy', icon: 'fa-crown', title: 'Ø£Ø±Ø´ÙŠÙÙŠ', desc: 'Ø£Ø¶ÙØª 100 ÙƒØªØ§Ø¨', type: 'add', target: 100 },
            
            { id: 'b_read_1', icon: 'fa-check', title: 'Ø£ÙˆÙ„ Ø¥Ù†Ø¬Ø§Ø²', desc: 'Ø£Ù†Ù‡ÙŠØª Ù‚Ø±Ø§Ø¡Ø© ÙƒØªØ§Ø¨', type: 'read', target: 1 },
            { id: 'b_read_5', icon: 'fa-check-double', title: 'Ù‚Ø§Ø±Ø¦ Ù†Ù‡Ù…', desc: 'Ø£Ù†Ù‡ÙŠØª 5 ÙƒØªØ¨', type: 'read', target: 5 },
            { id: 'b_read_10', icon: 'fa-graduation-cap', title: 'Ø­ÙƒÙŠÙ…', desc: 'Ø£Ù†Ù‡ÙŠØª 10 ÙƒØªØ¨', type: 'read', target: 10 },
            { id: 'b_read_20', icon: 'fa-medal', title: 'Ù‚Ø§Ø±Ù‰Ø¡ Ù…Ø­ØªØ±Ù', desc: 'Ø£Ù†Ù‡ÙŠØª 20 ÙƒØªØ§Ø¨Ø§Ù‹', type: 'read', target: 20 },
            { id: 'b_read_50', icon: 'fa-trophy', title: 'Ù‚Ø§Ø±Ù‰Ø¡ Ù†Ù‡Ù…', desc: 'Ø£Ù†Ù‡ÙŠØª 50 ÙƒØªØ§Ø¨Ø§Ù‹', type: 'read', target: 50 },
            { id: 'b_read_100', icon: 'fa-star', title: 'Ø£Ø³Ø·ÙˆØ±Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©', desc: 'Ø£Ù†Ù‡ÙŠØª 100 ÙƒØªØ§Ø¨', type: 'read', target: 100 },
            
            { id: 'b_explorer', icon: 'fa-compass', title: 'Ù…Ø³ØªÙƒØ´Ù', desc: 'Ø¨Ø­Ø« 5 Ù…Ø±Ø§Øª', type: 'search', target: 5 }, // Needs custom tracking logic or simplify
        ];
        
        // --- NEW: Rawiya Logic using FREE API (Pollinations) ---
        // Ù„Ø§ ÙŠÙˆØ¬Ø¯ API Key Ù‡Ù†Ø§ØŒ Ø§Ù„Ø®Ø¯Ù…Ø© Ù…Ø¬Ø§Ù†ÙŠØ© ØªÙ…Ø§Ù…Ø§Ù‹

        function toggleRawiyaChat() {
            const widget = document.getElementById('rawiyaWidget');
            const interface = document.getElementById('rawiyaInterface');
            const trigger = document.getElementById('rawiyaTrigger');
            
            if (widget.classList.contains('open')) {
                widget.classList.remove('open');
                interface.classList.remove('pointer-events-auto');
                interface.classList.add('opacity-0', 'pointer-events-none');
                trigger.classList.remove('opacity-0', 'pointer-events-none');
            } else {
                widget.classList.add('open');
                interface.classList.remove('opacity-0', 'pointer-events-none');
                interface.classList.add('pointer-events-auto');
                trigger.classList.add('opacity-0', 'pointer-events-none');
                const chatMessages = document.getElementById('chatMessages');
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
        }

        function sendQuickMessage(text) {
            document.getElementById('chatInput').value = text;
            sendMessage();
        }

        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const userMsg = input.value.trim();
            if(!userMsg) return;

            addMessageToChat(userMsg, 'user');
            input.value = '';

            const loadingId = addTypingIndicator();
            const userName = localStorage.getItem('libraryUserName') || 'ØµØ¯ÙŠÙ‚ÙŠ';
            
                        // ØªØ¹Ø±ÙŠÙ Ø´Ø®ØµÙŠØ© Ø±Ø§ÙˆÙŠØ©
                        const context = `
                        ØªØ¹Ù„ÙŠÙ…Ø§Øª Ù„Ù„Ù†Ø¸Ø§Ù…: Ø£Ù†ØªÙ "Ø±Ø§ÙˆÙŠØ©" (Rawiya).
                        - Ø´Ø®ØµÙŠØªÙƒ: ÙØªØ§Ø© Ø°ÙƒÙŠØ©ØŒ Ù…Ø«Ù‚ÙØ©ØŒ Ù…Ø­Ø¨Ø© Ù„Ù„ÙƒØªØ¨ØŒ Ù„Ø·ÙŠÙØ©ØŒ ÙˆÙ…Ø±Ø­Ø©.
                        - Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø°ÙŠ ØªØ®Ø§Ø·Ø¨ÙŠÙ‡: ${userName}.
                        - Ù…Ù‡Ù…ØªÙƒ: Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙƒØªØ¨ØŒ Ù…Ù†Ø§Ù‚Ø´Ø© Ø§Ù„Ø£ÙÙƒØ§Ø± Ø§Ù„Ø£Ø¯Ø¨ÙŠØ©ØŒ ØªÙ‚Ø¯ÙŠÙ… Ø§Ù‚ØªØ¨Ø§Ø³Ø§ØªØŒ ÙˆØªØ´Ø¬ÙŠØ¹Ù‡ Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©.
                        - Ø§Ù„Ø´Ø±Ø· Ø§Ù„ØµØ§Ø±Ù…: Ù„Ø§ ØªØªØ­Ø¯Ø«ÙŠ Ø£Ø¨Ø¯Ø§Ù‹ ÙÙŠ Ø£ÙŠ Ù…ÙˆØ¶ÙˆØ¹ Ø®Ø§Ø±Ø¬ Ø¥Ø·Ø§Ø± Ø§Ù„ÙƒØªØ¨ØŒ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©ØŒ Ø§Ù„Ø£Ø¯Ø¨ØŒ ÙˆØ§Ù„ÙƒØªØ§Ø¨Ø©.
                        - ØªØ¹Ù„ÙŠÙ…Ø§Øª Ù…Ø®Ø§Ø·Ø¨Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: Ø¹Ù†Ø¯ Ù…Ø®Ø§Ø·Ø¨Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… 
                            Ø§Ø³ØªØ®Ø¯Ù…ÙŠ Ø¯Ø§Ø¦Ù…Ø§Ù‹ ØµÙŠØºØ© Ø§Ù„Ù…Ø®Ø§Ø·Ø¨ Ø§Ù„Ù…Ø°ÙƒØ±. Ù…Ø«Ø§Ù„: "ÙŠØ§ ØµØ¯ÙŠÙ‚ÙŠ"ØŒ ÙˆØ§Ø³ØªØ®Ø¯Ù…ÙŠ Ø¶Ù…Ø§Ø¦Ø± ÙˆØ£ÙØ¹Ø§Ù„ Ø¨ØµÙŠØºØ© Ø§Ù„Ù…Ø°ÙƒØ± (Ù…Ø«Ù„: "Ù‡Ù„ Ù‚Ø±Ø£Øª ÙƒØªØ§Ø¨Ø§Ù‹ Ø£Ø¹Ø¬Ø¨ÙƒØŸ" Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„ØµÙŠØºØ© Ø§Ù„Ù…Ø¤Ù†Ø«Ø©).
                        - Ø§Ù„Ù„Ù‡Ø¬Ø©: ØªØ­Ø¯Ø«ÙŠ Ø¨Ù„ØºØ© Ø¹Ø±Ø¨ÙŠØ© ÙØµØ­Ù‰ Ù…Ø¨Ø³Ø·Ø© ÙˆÙˆØ¯ÙˆØ¯Ø©ØŒ ÙˆØ§Ø³ØªØ®Ø¯Ù…ÙŠ Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„ÙƒØªØ¨ ğŸ“šâœ¨.
                        `;

                        // ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø© Ù„Ù„Ù€ API Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ
                        // Ù†Ù‚ÙˆÙ… Ø¨Ø¯Ù…Ø¬ Ø§Ù„Ø³ÙŠØ§Ù‚ Ù…Ø¹ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ø£Ù† Ù‡Ø°Ø§ Ø§Ù„Ù€ API Ø¨Ø³ÙŠØ· ÙˆÙ„Ø§ ÙŠØ­ÙØ¸ Ø§Ù„Ø¬Ù„Ø³Ø©
                        const fullPrompt = `${context}\n\nØ§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${userMsg}\nØ±Ø§ÙˆÙŠØ©:`;

            try {
                const response = await fetch(`https://text.pollinations.ai/${encodeURIComponent(fullPrompt)}?model=openai&seed=${Math.floor(Math.random() * 1000)}`);
                
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }

                const aiText = await response.text();
                removeMessage(loadingId);
                
                if (aiText) {
                    addMessageToChat(aiText, 'bot');
                } else {
                    addMessageToChat("Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø¶Ø§Ø¹Øª Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ù…Ù†ÙŠ Ù„Ù„Ø­Ø¸Ø©.. Ù‡Ù„ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø³Ø¤Ø§Ù„ØŸ ğŸ˜…", 'bot');
                }
            } catch (error) {
                console.error("AI Error:", error);
                removeMessage(loadingId);
                addMessageToChat("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù…ÙƒØªØ¨ØªÙŠ Ø§Ù„Ø¹Ù‚Ù„ÙŠØ©. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª. ğŸ˜”", 'bot');
            }
        }

        function addMessageToChat(text, sender) {
            const chatMessages = document.getElementById('chatMessages');
            const div = document.createElement('div');
            const isUser = sender === 'user';
            
            div.className = `flex gap-3 animate-slide-up ${isUser ? 'justify-end' : ''}`;
            
            if (isUser) {
                div.innerHTML = `<div class="bg-indigo-600 p-3 rounded-2xl rounded-tl-none text-sm text-white max-w-[85%] border border-indigo-500 shadow-md">${text}</div>`;
            } else {
                div.innerHTML = `
                    <div class="w-8 h-8 rounded-full bg-pink-500 flex-shrink-0 flex items-center justify-center text-xs overflow-hidden border border-pink-400 shadow-sm self-end mb-1">
                        <i class="fa-solid fa-user-astronaut text-white"></i>
                    </div>
                    <div class="bg-slate-800 p-3 rounded-2xl rounded-tr-none text-sm text-slate-200 border border-slate-700 max-w-[85%] shadow-md leading-relaxed min-h-[40px]">${text.replace(/\n/g, '<br>')}</div>
                `;
            }
            chatMessages.appendChild(div);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function addTypingIndicator() {
            const chatMessages = document.getElementById('chatMessages');
            const id = 'typing-' + Date.now();
            const div = document.createElement('div');
            div.id = id;
            div.className = "flex gap-3 animate-fade-in";
            div.innerHTML = `
                <div class="w-8 h-8 rounded-full bg-pink-500 flex-shrink-0 flex items-center justify-center text-xs overflow-hidden border border-pink-400 shadow-sm self-center">
                    <i class="fa-solid fa-user-astronaut text-white"></i>
                </div>
                <div class="bg-slate-800 p-3 rounded-2xl rounded-tr-none border border-slate-700 flex gap-2 items-center h-10 shadow-md">
                    <span class="text-xs text-slate-400 font-bold">Ø±Ø§ÙˆÙŠØ© ØªÙƒØªØ¨...</span>
                    <span class="typing-cursor"></span>
                </div>
            `;
            chatMessages.appendChild(div);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            return id;
        }

        function removeMessage(id) {
            const el = document.getElementById(id);
            if(el) el.remove();
        }

        // --- Helper: Render Stars ---
        function renderStars(rating) {
            if(!rating) return '';
            let starsHtml = '';
            for (let i = 1; i <= 5; i++) {
                if (i <= rating) {
                    starsHtml += '<i class="fa-solid fa-star drop-shadow-[0_0_2px_rgba(251,191,36,0.8)]"></i>';
                } else if (i - 0.5 <= rating) {
                    starsHtml += '<i class="fa-solid fa-star-half-stroke drop-shadow-[0_0_2px_rgba(251,191,36,0.8)]"></i>';
                } else {
                    starsHtml += '<i class="fa-regular fa-star opacity-30"></i>';
                }
            }
            return starsHtml;
        }

        // --- General Trending (English/World) ---
        async function loadTrending(isReset = false) {
            const btn = document.getElementById('moreGlobalBtn');
            if(isReset) {
                trendingStartIndex = 0;
                document.getElementById('trendingGrid').innerHTML = '';
            } else {
                btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> ØªØ­Ù…ÙŠÙ„...';
                btn.disabled = true;
            }
            
            try {
                const res = await fetch(`https://www.googleapis.com/books/v1/volumes?q=subject:fiction&orderBy=newest&startIndex=${trendingStartIndex}&maxResults=40&langRestrict=en`);
                const data = await res.json();
                
                const grid = document.getElementById('trendingGrid');
                if(data.items && data.items.length > 0) {
                    currentBooksCache = [...currentBooksCache, ...data.items];
                    
                    data.items.forEach((book, index) => {
                        const delay = isReset ? index * 0.1 : 0.1;
                        grid.appendChild(createSmartCard(book, delay));
                    });
                    
                    trendingStartIndex += 40;
                } else if (!isReset) {
                    showToast('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„ÙƒØªØ¨', 'info');
                    btn.style.display = 'none';
                }
            } catch(e) { console.log(e); }
            
            btn.innerHTML = '<i class="fa-solid fa-plus mr-2"></i> Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø²ÙŠØ¯';
            btn.disabled = false;
        }

        // --- Mood Picker Logic ---
        function searchByMood(mood) {
            let query = "";
            let msg = "";
            if(mood === 'happy') { query = "comedy OR happiness OR joy"; msg = "ÙƒØªØ¨ ØªØ¨Ù‡Ø¬ Ù‚Ù„Ø¨Ùƒ"; }
            if(mood === 'mystery') { query = "mystery OR thriller OR crime"; msg = "ÙƒØªØ¨ Ù…Ù„ÙŠØ¦Ø© Ø¨Ø§Ù„ØºÙ…ÙˆØ¶"; }
            if(mood === 'love') { query = "romance OR love story"; msg = "Ø±ÙˆØ§ÙŠØ§Øª Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠØ©"; }
            
            document.getElementById('searchInput').value = query;
            searchBooks(true);
            showToast(msg, 'info');
        }

        // --- Search Functions ---
        async function searchBooks(isNewSearch = true) {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) return;

            if (isNewSearch) {
                addToSearchHistory(query);
                searchStartIndex = 0;
                document.getElementById('resultsGrid').innerHTML = '';
                document.getElementById('homeView').classList.add('hidden');
                document.getElementById('resultsArea').classList.remove('hidden');
                document.getElementById('resultsGrid').classList.add('hidden');
                document.getElementById('emptySearchState').classList.add('hidden');
                document.getElementById('loadingState').classList.remove('hidden');
                document.getElementById('loadMoreSearchContainer').classList.add('hidden');
            } else {
                 const btn = document.getElementById('moreSearchBtn');
                 btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> ØªØ­Ù…ÙŠÙ„...';
                 btn.disabled = true;
            }

            try {
                const res = await fetch(`https://www.googleapis.com/books/v1/volumes?q=${encodeURIComponent(query)}&maxResults=40&startIndex=${searchStartIndex}&orderBy=relevance&langRestrict=ar,en`);
                const data = await res.json();
                
                if (isNewSearch) document.getElementById('loadingState').classList.add('hidden');

                if (data.items && data.items.length > 0) {
                    currentBooksCache = [...currentBooksCache, ...data.items];
                    const grid = document.getElementById('resultsGrid');
                    grid.classList.remove('hidden');
                    
                    if(isNewSearch) {
                        // show only the number of results currently displayed (don't show the estimated total)
                        const shown = searchStartIndex + (data.items ? data.items.length : 0);
                        document.getElementById('resultCountBadge').innerText = shown;
                    }

                    data.items.forEach((book, index) => {
                        const delay = isNewSearch ? index * 0.05 : 0; 
                        grid.appendChild(createSmartCard(book, delay));
                    });
                    
                    searchStartIndex += 40;

                    const loadMoreContainer = document.getElementById('loadMoreSearchContainer');
                    loadMoreContainer.classList.remove('hidden');
                    
                    if (!isNewSearch) {
                         const btn = document.getElementById('moreSearchBtn');
                         btn.innerHTML = '<i class="fa-solid fa-plus mr-2"></i> Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø²ÙŠØ¯';
                         btn.disabled = false;
                    }

                } else {
                    if (isNewSearch) {
                        document.getElementById('emptySearchState').classList.remove('hidden');
                    } else {
                        showToast('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ù†ØªØ§Ø¦Ø¬', 'info');
                        document.getElementById('loadMoreSearchContainer').classList.add('hidden');
                    }
                }
            } catch (error) {
                console.error(error);
                if(isNewSearch) {
                    document.getElementById('loadingState').classList.add('hidden');
                    document.getElementById('emptySearchState').innerHTML = '<p class="text-red-400">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ØŒ Ø­Ø§ÙˆÙ„ Ù„Ø§Ø­Ù‚Ø§Ù‹.</p>';
                    document.getElementById('emptySearchState').classList.remove('hidden');
                } else {
                    const btn = document.getElementById('moreSearchBtn');
                    btn.innerHTML = '<i class="fa-solid fa-plus mr-2"></i> Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø²ÙŠØ¯';
                    btn.disabled = false;
                    showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø²ÙŠØ¯', 'red');
                }
            }
        }

        function createSmartCard(book, delay = 0) {
            const info = book.volumeInfo;
            const thumb = (info.imageLinks?.thumbnail || '').replace('http:', 'https:') || 'https://via.placeholder.com/128x196?text=No+Cover';
            const spineColor = stringToColor(info.title || 'book');
            const rating = info.averageRating;
            
            let smartDesc = info.categories ? info.categories[0] : 'ÙƒØªØ§Ø¨ Ø¹Ø§Ù…';
            if(info.pageCount > 500) smartDesc += ' â€¢ Ø¯Ø³Ù…';
            else if (info.pageCount < 150) smartDesc += ' â€¢ Ù‚Ø±Ø§Ø¡Ø© Ø³Ø±ÙŠØ¹Ø©';

            const div = document.createElement('div');
            div.style.animationDelay = `${delay}s`;
            div.className = "book-container-wrapper flex flex-col items-center group w-full max-w-[160px] animate-slide-up opacity-0 forwards mx-2"; 

            div.innerHTML = `
                <div class="book-wrapper mb-5" style="--delay: ${Math.random() * 2}s" data-book-id="${book.id}">
                    <div class="book-3d">
                        <div class="book-cover shadow-inner relative" style="background-image: url('${thumb}')">
                            ${myLibrary.some(b => b.id === book.id) ? '<div class="absolute top-2 left-2 bg-green-500 text-white text-[9px] font-bold px-2 py-1 rounded shadow z-10"><i class="fa-solid fa-check"></i></div>' : ''}
                            ${rating ? `<div class="absolute bottom-2 right-2 bg-black/80 text-star-gold text-[9px] px-2 py-1 rounded backdrop-blur-sm shadow flex gap-0.5 border border-white/10">${renderStars(rating)}</div>` : ''}
                        </div>
                        <div class="book-spine" style="background-color: ${spineColor}"></div>
                        <div class="book-pages"></div>
                    </div>
                </div>
                <div class="text-center w-full px-1">
                    <h3 class="font-bold text-sm text-slate-200 truncate w-full mb-1 group-hover:text-indigo-400 transition-colors" title="${info.title}">${info.title}</h3>
                    <p class="text-[10px] text-indigo-400 font-bold mb-1 opacity-70 group-hover:opacity-100 transition-opacity">${smartDesc}</p>
                    <p class="text-[11px] text-slate-400 mb-2">${info.pageCount ? 'Ø¹Ø¯Ø¯ Ø§Ù„ØµÙØ­Ø§Øª: ' + info.pageCount + ' ØµÙØ­Ø©' : ''}</p>
                    <button onclick="handleShelfAction(event, '${book.id}', '${thumb}')" 
                        class="w-full py-2 rounded-xl text-xs font-bold transition-all duration-300 bg-slate-800 text-slate-400 hover:text-white hover:bg-indigo-600 border border-slate-700 hover:shadow-lg hover:shadow-indigo-500/30 active:scale-95">
                        ${myLibrary.some(b => b.id === book.id) ? 'Ù…Ø­ÙÙˆØ¸' : 'Ø£Ø¶Ù Ù„Ù„Ø±Ù'}
                    </button>
                </div>
            `;

            // Attach click listener to wrapper to avoid inline-attribute quoting issues
            const wrapper = div.querySelector('.book-wrapper');
            if (wrapper) {
                wrapper.addEventListener('click', (ev) => {
                    ev.preventDefault();
                    const bid = wrapper.dataset.bookId;
                    if (bid) openDetails(bid);
                });
            }

            return div;
        }

        // --- Standard Utility & Modal Functions ---
        async function openDetails(id) {
            let book = currentBooksCache.find(b => b.id === id) || myLibrary.find(b => b.id === id);
            if (!book) {
                try {
                    const res = await fetch(`https://www.googleapis.com/books/v1/volumes/${id}`);
                    if (res.ok) book = await res.json();
                } catch (e) { console.warn('fallback fetch failed', e); }
            }
            if (!book) { showToast('ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙƒØªØ§Ø¨', 'info'); return; }

            const info = book.volumeInfo;
            activeBookMoreInfo = info;
            activeBookMoreInfo.link = info.previewLink || info.infoLink; 

            const modal = document.getElementById('bookModal');
            modal.dataset.activeId = id;

            document.getElementById('modalTitle').innerText = info.title;
            document.getElementById('modalAuthors').innerText = info.authors ? info.authors.join('ØŒ ') : 'Ù…Ø¤Ù„Ù ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
            document.getElementById('modalDesc').innerHTML = info.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ Ù…ØªØ§Ø­ Ù„Ù‡Ø°Ø§ Ø§Ù„ÙƒØªØ§Ø¨ØŒ Ù„ÙƒÙ† Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙŠØ¨Ø¯Ùˆ Ù…Ø«ÙŠØ±Ø§Ù‹ Ù„Ù„Ø§Ù‡ØªÙ…Ø§Ù…!';
            document.getElementById('modalImg').src = (info.imageLinks?.thumbnail || '').replace('http:', 'https:') || 'https://via.placeholder.com/200x300';
            document.getElementById('modalBlurBg').src = document.getElementById('modalImg').src;
            document.getElementById('modalPreviewLink').href = info.previewLink;

            document.getElementById('modalPageBadge').innerText = `${info.pageCount || '?'} ØµÙØ­Ø©`;
            document.getElementById('modalYearBadge').innerText = info.publishedDate ? info.publishedDate.substring(0,4) : 'N/A';
            document.getElementById('modalLangBadge').innerText = (info.language || 'en').toUpperCase();

            const ratingContainer = document.getElementById('modalRating');
            if(info.averageRating) {
                ratingContainer.innerHTML = `
                    <div class="flex items-center gap-1 bg-black/40 px-2 py-1 rounded-lg backdrop-blur-sm border border-slate-700/50 w-fit">
                        <span class="text-white font-bold mr-1 text-sm">${info.averageRating}</span>
                        <div class="flex text-star-gold text-xs">${renderStars(info.averageRating)}</div>
                        <span class="text-slate-400 text-[10px] ml-1">(${info.ratingsCount || 0})</span>
                    </div>`;
            } else {
                ratingContainer.innerHTML = '';
            }

            const cats = info.categories ? info.categories[0] : 'ØºÙŠØ± Ù…ØµÙ†Ù';
            document.getElementById('modalGenre').innerText = cats;
            
            let difficulty = "Ù…ØªÙˆØ³Ø·";
            if(info.pageCount < 200) difficulty = "Ù…Ø¨ØªØ¯Ø¦";
            if(info.pageCount > 500) difficulty = "Ù…ØªÙ‚Ø¯Ù…";
            document.getElementById('modalDifficulty').innerText = difficulty;

            document.getElementById('moreInfoContent').classList.add('hidden');
            document.getElementById('moreInfoText').innerText = 'Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ©';
            document.getElementById('moreInfoIcon').className = 'fa-solid fa-chevron-down';

            const savedBook = myLibrary.find(b => b.id === id);
            const notesArea = document.getElementById('bookNotes');
            const statusContainer = document.getElementById('readingStatusContainer');
            const progressContainer = document.getElementById('progressContainer');

            if(savedBook) {
                notesArea.value = savedBook.userNotes || '';
                notesArea.disabled = false;
                notesArea.placeholder = "Ø¯ÙˆÙ† Ø£ÙÙƒØ§Ø±Ùƒ ÙˆÙ…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ø­ÙˆÙ„ Ø§Ù„ÙƒØªØ§Ø¨ Ù‡Ù†Ø§...";
                updateModalBtn(true);
                
                statusContainer.classList.remove('hidden');
                const currentStatus = savedBook.readingStatus || 'unread';
                document.getElementById(`status-${currentStatus}`).checked = true;
                    if(currentStatus === 'finished') {
                        // disable status radios for completed books to prevent accidental clicks
                        document.querySelectorAll('.status-radio').forEach(r => r.disabled = true);
                    } else {
                        document.querySelectorAll('.status-radio').forEach(r => r.disabled = false);
                    }
                
                // Show/Hide Progress slider based on status
                if(currentStatus === 'reading') {
                    progressContainer.classList.remove('hidden');
                    const progress = savedBook.progress || 0;
                    document.getElementById('readingProgress').value = progress;
                    document.getElementById('progressValue').innerText = progress + '%';
                } else {
                    progressContainer.classList.add('hidden');
                }

            } else {
                notesArea.value = '';
                notesArea.disabled = true;
                notesArea.placeholder = "ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒØªØ§Ø¨ Ù„Ù„Ø±Ù Ù„ØªØªÙ…ÙƒÙ† Ù…Ù† ØªØ¯ÙˆÙŠÙ† Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª.";
                updateModalBtn(false);
                statusContainer.classList.add('hidden');
            }

            const btn = document.getElementById('modalShelfBtn');
            const newBtn = btn.cloneNode(true);
            btn.parentNode.replaceChild(newBtn, btn);
            
            newBtn.onclick = () => {
                const isSaved = myLibrary.some(b => b.id === id);
                if(isSaved) {
                    removeFromShelf(id);
                    notesArea.disabled = true;
                    notesArea.value = '';
                    notesArea.placeholder = "ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒØªØ§Ø¨ Ù„Ù„Ø±Ù Ù„ØªØªÙ…ÙƒÙ† Ù…Ù† ØªØ¯ÙˆÙŠÙ† Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª.";
                    statusContainer.classList.add('hidden');
                    updateModalBtn(false);
                } else {
                    addToShelf(book);
                    notesArea.disabled = false;
                    notesArea.placeholder = "Ø¯ÙˆÙ† Ø£ÙÙƒØ§Ø±Ùƒ ÙˆÙ…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ø­ÙˆÙ„ Ø§Ù„ÙƒØªØ§Ø¨ Ù‡Ù†Ø§...";
                    statusContainer.classList.remove('hidden');
                    document.getElementById('status-unread').checked = true;
                    progressContainer.classList.add('hidden');
                    updateModalBtn(true);
                }
            };
            
            updateModalBtn(savedBook !== undefined);

            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                document.getElementById('modalContent').classList.remove('scale-95');
            }, 10);
        }

        function updateModalBtn(isSaved) {
            const btn = document.getElementById('modalShelfBtn');
            if(isSaved) {
                btn.className = "flex-[2] py-3 bg-red-500/10 hover:bg-red-500/20 text-red-400 border border-red-500/50 rounded-xl text-sm font-bold transition-all flex items-center justify-center gap-2";
                btn.innerHTML = '<i class="fa-solid fa-trash-can"></i> <span>Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ø±Ù</span>';
            } else {
                btn.className = "flex-[2] py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl text-sm font-bold shadow-lg shadow-indigo-500/30 transition-all flex items-center justify-center gap-2 hover:scale-[1.02]";
                btn.innerHTML = '<i class="fa-regular fa-heart"></i> <span>Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø±Ù</span>';
            }
        }

        function toggleMoreInfo() {
            const content = document.getElementById('moreInfoContent');
            const icon = document.getElementById('moreInfoIcon');
            const text = document.getElementById('moreInfoText');
            
            if(content.classList.contains('hidden')) {
                const info = activeBookMoreInfo;
                let isbn = 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
                if(info.industryIdentifiers) {
                    const isbnObj = info.industryIdentifiers.find(i => i.type === 'ISBN_13') || info.industryIdentifiers[0];
                    isbn = isbnObj ? isbnObj.identifier : 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
                }

                content.innerHTML = `
                    <div class="col-span-1"><span class="text-slate-500 block mb-1">Ø§Ù„Ù†Ø§Ø´Ø±</span><span class="text-slate-200">${info.publisher || '-'}</span></div>
                    <div class="col-span-1"><span class="text-slate-500 block mb-1">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø´Ø±</span><span class="text-slate-200">${info.publishedDate || '-'}</span></div>
                    <div class="col-span-1"><span class="text-slate-500 block mb-1">ISBN</span><span class="font-mono text-slate-300">${isbn}</span></div>
                    <div class="col-span-1"><span class="text-slate-500 block mb-1">Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</span><span class="text-slate-200">${info.categories ? info.categories.join('ØŒ ') : '-'}</span></div>
                `;

                content.classList.remove('hidden');
                icon.className = 'fa-solid fa-chevron-up';
                text.innerText = 'Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªÙØ§ØµÙŠÙ„';
            } else {
                content.classList.add('hidden');
                icon.className = 'fa-solid fa-chevron-down';
                text.innerText = 'Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ©';
            }
        }

        function saveNote(id, text) {
            const index = myLibrary.findIndex(b => b.id === id);
            if(index !== -1) {
                myLibrary[index].userNotes = text;
                localStorage.setItem('myLibrary_Inspire', JSON.stringify(myLibrary));
            }
        }

        // --- Update Book Status & Progress ---
        function updateBookStatus(status) {
            const id = document.getElementById('bookModal').dataset.activeId;
            const index = myLibrary.findIndex(b => b.id === id);
            const progressContainer = document.getElementById('progressContainer');
            
            if(index !== -1) {
                myLibrary[index].readingStatus = status;
                if(status === 'reading') {
                    progressContainer.classList.remove('hidden');
                } else {
                    progressContainer.classList.add('hidden');
                }

                // If user marks as finished, set progress to 100 and prevent re-click
                if(status === 'finished') {
                    myLibrary[index].progress = 100;
                    // disable status radios to prevent immediate re-click
                    document.querySelectorAll('.status-radio').forEach(r => { r.disabled = true; });
                    showToast('âœ”ï¸ ØªÙ… Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„ â€” Ù…Ø¨Ø±ÙˆÙƒ!', 'success');
                }

                localStorage.setItem('myLibrary_Inspire', JSON.stringify(myLibrary));
                updateShelfUI(); 
                checkAchievements(); // Check if user unlocked badges
            }
        }

        function updateProgress(val) {
            const id = document.getElementById('bookModal').dataset.activeId;
            const index = myLibrary.findIndex(b => b.id === id);
            document.getElementById('progressValue').innerText = val + '%';
            
            if(index !== -1) {
                myLibrary[index].progress = val;
                localStorage.setItem('myLibrary_Inspire', JSON.stringify(myLibrary));
                updateShelfUI();
            }
        }

        function handleShelfAction(e, id, imgUrl) {
            e.stopPropagation();
            const book = currentBooksCache.find(b => b.id === id);
            const btn = (e.target && e.target.closest) ? e.target.closest('button') : null;
            if(myLibrary.some(b => b.id === id)) {
                showToast('Ø§Ù„ÙƒØªØ§Ø¨ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ Ù…ÙƒØªØ¨ØªÙƒ', 'info');
                if(btn) { btn.disabled = true; btn.classList.add('opacity-60', 'cursor-not-allowed'); }
                return;
            }

            if(btn) {
                // optimistic UI: disable and show saving text
                btn.disabled = true;
                const prevTxt = btn.innerHTML;
                btn.innerText = 'Ø¬Ø§Ø±Ù Ø§Ù„Ø­ÙØ¸...';
                btn.classList.add('opacity-70');

                // perform action
                if(book) {
                    const cover = e.target.closest('.group').querySelector('.book-cover');
                    flyToCart(cover, imgUrl);
                    try {
                        addToShelf(book);
                        // finalize button state
                        btn.innerText = 'Ù…Ø­ÙÙˆØ¸';
                        btn.classList.add('bg-green-600', 'text-white');
                    } catch (err) {
                        // rollback
                        btn.innerHTML = prevTxt;
                        btn.disabled = false;
                        showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸', 'red');
                    }
                } else {
                    // If book not in cache, simple fail safe
                    btn.innerHTML = prevTxt;
                    btn.disabled = false;
                    showToast('ØºÙŠØ± Ù‚Ø§Ø¯Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØªØ§Ø¨', 'red');
                }
            } else {
                if(book) {
                    const cover = e.target.closest('.group').querySelector('.book-cover');
                    flyToCart(cover, imgUrl);
                    addToShelf(book);
                }
            }
        }

        function addToShelf(book) {
            myLibrary.push({ ...book, userNotes: '', readingStatus: 'unread', progress: 0 });
            localStorage.setItem('myLibrary_Inspire', JSON.stringify(myLibrary));
            updateShelfUI();
            const cartBtn = document.getElementById('cartBtn');
            cartBtn.classList.add('shelf-bounce');
            setTimeout(() => cartBtn.classList.remove('shelf-bounce'), 600);
            showToast('ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            checkAchievements(); // Check adding badges
        }

        function removeFromShelf(id) {
            myLibrary = myLibrary.filter(b => b.id !== id);
            localStorage.setItem('myLibrary_Inspire', JSON.stringify(myLibrary));
            updateShelfUI();
            showToast('ØªÙ…Øª Ø§Ù„Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ù…ÙƒØªØ¨Ø©', 'red');
        }

        function pickRandomBook() {
            const unread = myLibrary.filter(b => b.readingStatus === 'unread');
            if (unread.length === 0) {
                showToast('Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ÙƒØªØ¨ ØºÙŠØ± Ù…Ù‚Ø±ÙˆØ¡Ø© Ù„Ø§Ù‚ØªØ±Ø§Ø­Ù‡Ø§!', 'info');
                return;
            }
            const randomBook = unread[Math.floor(Math.random() * unread.length)];
            if(!currentBooksCache.find(b => b.id === randomBook.id)) {
                currentBooksCache.push(randomBook);
            }
            openDetails(randomBook.id);
            showToast('Ù…Ø§ Ø±Ø£ÙŠÙƒ Ø¨Ù‡Ø°Ø§ Ø§Ù„ÙƒØªØ§Ø¨ØŸ', 'success');
        }

        // --- UPDATED: Shelf UI & Badges Rendering ---
        function updateShelfUI() {
            const container = document.getElementById('shelfContent');
            const countBadge = document.getElementById('shelfCount');
            const statusText = document.getElementById('shelfStatusText'); 
            const badgesContainer = document.getElementById('badgesContainer');
            
            const count = myLibrary.length;
            const percentage = Math.min((count / 20) * 100, 100);
            document.getElementById('challengeCount').innerText = `${count} / 20 ÙƒØªØ§Ø¨`;
            document.getElementById('challengeBar').style.width = `${percentage}%`;

            countBadge.innerText = count;
            countBadge.style.transform = count > 0 ? 'scale(1)' : 'scale(0)';
            if(count === 0) statusText.innerText = "Ø£Ø±ÙÙÙƒ ÙØ§Ø±ØºØ©.. ØªÙ†ØªØ¸Ø± Ø§Ù„Ø­ÙƒØ§ÙŠØ§";
            else if(count < 5) statusText.innerText = "Ø¨Ø¯Ø§ÙŠØ© Ù…ÙˆÙÙ‚Ø©ØŒ Ø§Ø³ØªÙ…Ø±!";
            else statusText.innerText = `Ù„Ø¯ÙŠÙƒ ${count} ÙƒØªØ§Ø¨Ø§Ù‹ØŒ Ù…ÙƒØªØ¨Ø© Ø±Ø§Ø¦Ø¹Ø©!`;

            // Render Badges (include data-badge-id for targetable animation and visible title)
            badgesContainer.innerHTML = badgesData.map(badge => {
                const isUnlocked = unlockedBadges.includes(badge.id);
                return `
                <div data-badge-id="${badge.id}" class="flex flex-col items-center gap-1 group cursor-help" title="${badge.title}: ${badge.desc}">
                    <div class="w-10 h-10 rounded-full flex items-center justify-center text-lg transition-all shadow-inner ${isUnlocked ? 'badge-unlocked bg-indigo-500/20 text-indigo-400 border-indigo-500' : 'bg-slate-800 border-slate-700 text-slate-600 badge-locked'}">
                        <i class="fa-solid ${badge.icon}"></i>
                    </div>
                    <div class="text-[11px] text-slate-300 mt-1 text-center" style="max-width:72px;">${badge.title}</div>
                </div>
                `;
            }).join('');

            if (count === 0) {
                container.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-64 text-slate-500 opacity-60 text-center animate-fade-in">
                        <i class="fa-solid fa-book-open-reader text-6xl mb-4 text-indigo-500/30"></i>
                        <p class="font-bold text-sm text-slate-400">Ù…ÙƒØªØ¨ØªÙƒ Ù‡Ø§Ø¯Ø¦Ø© Ø¬Ø¯Ø§Ù‹</p>
                        <p class="text-xs mt-1 text-slate-500">Ø§Ø¨Ø­Ø« Ø¹Ù† ÙƒØªØ§Ø¨ ÙˆØ§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ</p>
                    </div>`;
                // ensure container is visible and scrollable even when empty
                container.style.display = '';
                container.style.minHeight = '180px';
                container.scrollTop = 0;
                return;
            }
            // ensure container visible and reset scroll
            container.style.display = '';
            container.style.minHeight = '180px';
            container.scrollTop = 0;

            container.innerHTML = myLibrary.map(book => {
                const info = book.volumeInfo;
                const img = (info.imageLinks?.thumbnail || '').replace('http:', 'https:');
                
                let statusBadge = '';
                let progressDisplay = '';

                if(book.readingStatus === 'reading') {
                    statusBadge = '<span class="text-[9px] bg-yellow-500/20 text-yellow-400 px-2 py-0.5 rounded-md border border-yellow-500/30 font-bold">Ø£Ù‚Ø±Ø£Ù‡ Ø§Ù„Ø¢Ù†</span>';
                    const prog = book.progress || 0;
                    progressDisplay = `<div class="w-full bg-slate-900/50 h-1.5 mt-2 rounded-full overflow-hidden"><div class="bg-gradient-to-r from-yellow-500 to-orange-500 h-full" style="width: ${prog}%"></div></div>`;
                }
                else if(book.readingStatus === 'finished') {
                    statusBadge = '<span class="text-[9px] bg-green-500/20 text-green-400 px-2 py-0.5 rounded-md border border-green-500/30 font-bold">ØªÙ…Øª Ù‚Ø±Ø§Ø¡ØªÙ‡</span>';
                }
                else {
                    statusBadge = '<span class="text-[9px] bg-slate-700/50 text-slate-400 px-2 py-0.5 rounded-md border border-slate-600 font-bold">Ù„Ù… Ø£Ø¨Ø¯Ø£</span>';
                }

                return `
                <div class="glass-card p-3 rounded-2xl mb-4 flex gap-4 items-center group hover:bg-slate-800/80 transition-all duration-300 relative border-l-4 border-l-transparent hover:border-l-indigo-500">
                    <img src="${img}" class="w-12 h-16 object-cover rounded shadow-md cursor-pointer hover:scale-110 transition-transform duration-300" onclick="openDetails('${book.id}')">
                    <div class="flex-1 min-w-0 cursor-pointer" onclick="openDetails('${book.id}')">
                        <h4 class="text-sm font-bold text-slate-200 truncate group-hover:text-indigo-400 transition-colors">${info.title}</h4>
                        <p class="text-[10px] text-slate-400 truncate mb-1.5">${info.authors?.[0] || ''}</p>
                        <p class="text-[11px] text-slate-400">${info.pageCount ? 'Ø¹Ø¯Ø¯ Ø§Ù„ØµÙØ­Ø§Øª: ' + info.pageCount + ' ØµÙØ­Ø©' : ''}</p>
                        <div class="flex flex-col items-start w-full">
                            ${statusBadge}
                            ${progressDisplay}
                        </div>
                    </div>
                    <button onclick="removeFromShelf('${book.id}')" class="w-7 h-7 rounded-full hover:bg-red-500/20 text-slate-600 hover:text-red-500 flex items-center justify-center transition-colors self-start -mt-1 -ml-1">
                        <i class="fa-solid fa-trash-can text-xs"></i>
                    </button>
                </div>`;
            }).join('');
        }

        // --- NEW: Check Achievements Logic ---
        function checkAchievements() {
            const addCount = myLibrary.length;
            const readCount = myLibrary.filter(b => b.readingStatus === 'finished').length;
            
            badgesData.forEach(badge => {
                if(unlockedBadges.includes(badge.id)) return; // Already unlocked

                let unlocked = false;
                if(badge.type === 'add' && addCount >= badge.target) unlocked = true;
                if(badge.type === 'read' && readCount >= badge.target) unlocked = true;
                
                if(unlocked) {
                    unlockedBadges.push(badge.id);
                    localStorage.setItem('unlockedBadges_Inspire', JSON.stringify(unlockedBadges));
                    triggerCelebration(badge);
                    updateShelfUI(); // To update sidebar icons
                }
            });
        }

        function triggerCelebration(badge) {
            document.getElementById('achievementTitle').innerText = badge.title;
            // Simple quote logic, could be random
            const quotes = [
                "Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ù‡Ùˆ Ø£Ù† ØªÙƒÙˆÙ† Ø£ÙØ¶Ù„ Ù…Ù…Ø§ ÙƒÙ†Øª Ø¹Ù„ÙŠÙ‡ Ø¨Ø§Ù„Ø£Ù…Ø³.",
                "Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© ØªÙ…Ù†Ø­Ùƒ Ù…ÙƒØ§Ù†Ø§Ù‹ ØªØ°Ù‡Ø¨ Ø¥Ù„ÙŠÙ‡ Ø¹Ù†Ø¯Ù…Ø§ ØªØ¶Ø·Ø± Ù„Ù„Ø¨Ù‚Ø§Ø¡ ÙÙŠ Ù…ÙƒØ§Ù†Ùƒ.",
                "ÙƒÙ„ ÙƒØªØ§Ø¨ Ù‡Ùˆ Ø­Ù„Ù… ØªÙ…Ø³ÙƒÙ‡ Ø¨ÙŠÙ† ÙŠØ¯ÙŠÙƒ."
            ];
            document.getElementById('achievementQuote').innerText = `"${quotes[Math.floor(Math.random()*quotes.length)]}"`;
            
            const modal = document.getElementById('achievementModal');
            modal.classList.remove('hidden');
            
            // Generate confetti
            const container = document.getElementById('confettiContainer');
            container.innerHTML = '';
            for(let i=0; i<30; i++) {
                const conf = document.createElement('div');
                conf.className = 'confetti-piece';
                conf.style.left = Math.random() * 100 + '%';
                conf.style.backgroundColor = ['#f472b6', '#6366f1', '#fbbf24', '#34d399'][Math.floor(Math.random()*4)];
                conf.style.animation = `confetti ${1 + Math.random()}s linear forwards`;
                container.appendChild(conf);
            }
            // Visual badge pulse in sidebar if present
            try {
                const badgeEl = document.querySelector(`#badgesContainer [data-badge-id="${badge.id}"] .w-10`);
                if(badgeEl) {
                    badgeEl.classList.add('badge-unlocked');
                    setTimeout(() => badgeEl.classList.remove('badge-unlocked'), 2200);
                }
            } catch(e){}

            // Friendly toast
            showToast(`ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ! Ø­ØµÙ„Øª Ø¹Ù„Ù‰ ÙˆØ³Ø§Ù… Ø¬Ø¯ÙŠØ¯: ${badge.title}`, 'success');
        }
        
        function closeAchievementModal() {
            document.getElementById('achievementModal').classList.add('hidden');
        }

        // --- Stats Modal Logic ---
        function showStatsModal() {
            const totalBooks = myLibrary.length;
            const totalPages = myLibrary.reduce((acc, book) => acc + (book.volumeInfo.pageCount || 0), 0);
            
            document.getElementById('statsTotalBooks').innerText = totalBooks;
            document.getElementById('statsTotalPages').innerText = totalPages.toLocaleString();

            const msgEl = document.getElementById('statsMessage');
            if (totalPages > 5000) msgEl.innerText = "ÙŠØ§ Ù„Ù„Ù‡ÙˆÙ„! Ù„Ù‚Ø¯ Ø¬Ù…Ø¹Øª Ø£ÙƒØ«Ø± Ù…Ù† 5000 ØµÙØ­Ø© Ù…Ù† Ø§Ù„Ù…Ø¹Ø±ÙØ©. Ø£Ù†Øª Ù…ÙˆØ³ÙˆØ¹Ø© ØªÙ…Ø´ÙŠ Ø¹Ù„Ù‰ Ù‚Ø¯Ù…ÙŠÙ†!";
            else if (totalPages > 1000) msgEl.innerText = "Ø±Ø§Ø¦Ø¹! Ù„Ù‚Ø¯ ØªØ¬Ø§ÙˆØ²Øª Ø­Ø§Ø¬Ø² Ø§Ù„Ù€ 1000 ØµÙØ­Ø©. Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø¨Ù†Ø§Ø¡ Ø¹Ù‚Ù„Ùƒ.";
            else if (totalBooks > 0) msgEl.innerText = "Ø¨Ø¯Ø§ÙŠØ© Ø¬ÙŠØ¯Ø©! ÙƒÙ„ ØµÙØ­Ø© ØªÙ‚Ø±Ø£Ù‡Ø§ Ù‡ÙŠ Ø§Ø³ØªØ«Ù…Ø§Ø± ÙÙŠ Ù…Ø³ØªÙ‚Ø¨Ù„Ùƒ.";
            else msgEl.innerText = "Ù…ÙƒØªØ¨ØªÙƒ ÙØ§Ø±ØºØ©! Ø£Ø¶Ù Ø¨Ø¹Ø¶ Ø§Ù„ÙƒØªØ¨ Ù„ØªØ¨Ø¯Ø£ Ø£Ø±Ù‚Ø§Ù…Ùƒ ÙÙŠ Ø§Ù„ØµØ¹ÙˆØ¯.";

            document.getElementById('statsModal').classList.remove('hidden');
        }

        function closeStatsModal() {
            document.getElementById('statsModal').classList.add('hidden');
        }

        // --- NEW: Reading Timer Logic ---
        let timerInterval;
        let seconds = 0;
        let isRunning = false;

        function toggleTimer() {
            const btn = document.getElementById('timerBtn');
            const display = document.getElementById('timerDisplay');
            
            if (!btn || !display) return;

            if(isRunning) {
                // Stop
                clearInterval(timerInterval);
                isRunning = false;
                btn.innerHTML = '<i class="fa-solid fa-play"></i> Ø§Ø³ØªØ¦Ù†Ø§Ù';
                btn.classList.replace('bg-red-600', 'bg-indigo-600');
                btn.classList.replace('hover:bg-red-700', 'hover:bg-indigo-700');
                display.classList.remove('timer-active');
            } else {
                // Start
                isRunning = true;
                btn.innerHTML = '<i class="fa-solid fa-pause"></i> Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª';
                btn.classList.replace('bg-indigo-600', 'bg-red-600');
                btn.classList.replace('hover:bg-indigo-700', 'hover:bg-red-700');
                display.classList.add('timer-active');
                
                timerInterval = setInterval(() => {
                    seconds++;
                    const mins = Math.floor(seconds / 60).toString().padStart(2, '0');
                    const secs = (seconds % 60).toString().padStart(2, '0');
                    display.innerText = `${mins}:${secs}`;
                }, 1000);
            }
        }

        // --- ENHANCED: Share Logic with Metadata ---
        function shareMyLibrary() {
            const userName = localStorage.getItem('libraryUserName') || 'ØµØ¯ÙŠÙ‚';
            
            if (myLibrary.length === 0) {
                showToast("Ù…ÙƒØªØ¨ØªÙƒ ÙØ§Ø±ØºØ©! Ø£Ø¶Ù ÙƒØªØ¨Ø§Ù‹ Ø£ÙˆÙ„Ø§Ù‹", "info");
                return;
            }

            const btn = document.getElementById('shareLibBtn');
            btn.disabled = true;

            // Encode Status and Progress
            // Format: id|status|progress
            const bookData = myLibrary.map(b => {
                const status = b.readingStatus || 'unread';
                const progress = b.progress || 0;
                return `${b.id}|${status}|${progress}`;
            }).join(',');
            
            // Create URL Params
            const params = new URLSearchParams();
            params.set('share_name', userName);
            params.set('share_data', bookData); 

            // Construct Full URL
            const shareUrl = `${window.location.origin}${window.location.pathname}?${params.toString()}`;

            // Show Share Modal
            document.getElementById('shareLinkInput').value = shareUrl;
            document.getElementById('shareModal').classList.remove('hidden');
            
            btn.disabled = false;
        }
        
        function closeShareModal() {
            document.getElementById('shareModal').classList.add('hidden');
        }
        
        function copyShareLink() {
            const copyText = document.getElementById("shareLinkInput");
            copyText.select();
            copyText.setSelectionRange(0, 99999);
            document.execCommand("copy");
            // Improved Notification as requested
            const toastIcon = document.getElementById('toastIcon');
            toastIcon.className = "fa-solid fa-link";
            showToast("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨Ù†Ø¬Ø§Ø­", "success");
            setTimeout(() => toastIcon.className = "fa-solid fa-check", 3000);
        }

        // Check URL for shared books on load
        async function checkSharedUrl() {
            const params = new URLSearchParams(window.location.search);
            const shareData = params.get('share_data'); 
            const shareName = params.get('share_name');

            if (shareData) {
                // Show loading modal immediately
                const modal = document.getElementById('sharedShelfModal');
                const grid = document.getElementById('sharedGrid');
                document.getElementById('sharedOwnerName').innerText = shareName || "Ù…Ø¬Ù‡ÙˆÙ„";
                grid.innerHTML = '<div class="col-span-full text-center py-20 text-slate-400"><i class="fa-solid fa-circle-notch fa-spin text-3xl mb-4 text-indigo-500"></i><br>Ø¬Ø§Ø±ÙŠ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„ÙƒØªØ¨...</div>';
                modal.classList.remove('hidden');

                const fetchedBooks = [];
                let idsToFetch = [];
                let metadataMap = {};

                if (shareData) {
                    const items = shareData.split(',');
                    idsToFetch = items.map(item => {
                        const [id, status, progress] = item.split('|');
                        metadataMap[id] = { status, progress: parseInt(progress) || 0 };
                        return id;
                    }).slice(0, 30);
                }
                
                try {
                    const promises = idsToFetch.map(id => 
                        fetch(`https://www.googleapis.com/books/v1/volumes/${id}`)
                        .then(res => res.json())
                        .catch(e => null)
                    );
                    
                    const results = await Promise.all(promises);
                    
                    grid.innerHTML = ''; // Clear loader

                    results.forEach(book => {
                        if(book && book.id) {
                            if (metadataMap[book.id]) {
                                book.sharedMetadata = metadataMap[book.id];
                            }
                            
                            fetchedBooks.push(book); 
                            const info = book.volumeInfo || {};
                            const thumb = (info.imageLinks?.thumbnail || '').replace('http:', 'https:') || 'https://via.placeholder.com/128x196?text=No+Cover';
                            
                            let statusBadge = '';
                            if(book.sharedMetadata) {
                                const s = book.sharedMetadata.status;
                                if(s === 'reading') statusBadge = '<span class="text-[9px] bg-yellow-500/20 text-yellow-400 px-2 py-0.5 rounded-full ml-1 font-bold">ÙŠÙ‚Ø±Ø£Ù‡</span>';
                                else if(s === 'finished') statusBadge = '<span class="text-[9px] bg-green-500/20 text-green-400 px-2 py-0.5 rounded-full ml-1 font-bold">Ø£Ù†Ù‡Ø§Ù‡</span>';
                            }

                            const div = document.createElement('div');
                            div.className = "flex flex-col items-center gap-3 bg-slate-700/30 p-3 rounded-2xl border border-slate-600/50 animate-fade-in group hover:bg-slate-700/50 transition-colors";
                            div.innerHTML = `
                                <div class="relative">
                                    <img src="${thumb}" class="w-24 h-36 object-cover rounded-lg shadow-md group-hover:scale-110 transition-transform duration-300">
                                    ${statusBadge ? `<div class="absolute -top-2 -right-2 z-10 shadow-sm">${statusBadge}</div>` : ''}
                                </div>
                                <h4 class="text-xs text-center font-bold text-slate-200 w-full truncate px-1 mt-1" title="${info.title}">${info.title}</h4>
                                <button onclick="importSingleBook('${book.id}')" class="text-[10px] bg-indigo-600 hover:bg-indigo-500 text-white px-4 py-2 rounded-full transition-all w-full mt-1 shadow-lg shadow-indigo-500/20 font-bold hover:-translate-y-0.5 transform active:scale-95">
                                    <i class="fa-solid fa-plus mr-1"></i> Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ù…ÙƒØªØ¨ØªÙŠ
                                </button>
                            `;
                            grid.appendChild(div);
                        }
                    });

                    window.tempSharedBooksCache = fetchedBooks;
                    window.history.replaceState({}, document.title, window.location.pathname);

                } catch (error) {
                    console.error(error);
                    grid.innerHTML = '<div class="col-span-full text-red-400 text-center py-10">Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒØªØ¨ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©.</div>';
                }
            }
        }

        window.importSingleBook = function(bookId) {
            const book = window.tempSharedBooksCache.find(b => b.id === bookId);
            if(book) {
                if(myLibrary.some(b => b.id === book.id)) {
                    showToast("Ø§Ù„ÙƒØªØ§Ø¨ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„ Ù„Ø¯ÙŠÙƒ", "info");
                } else {
                    const newBook = {
                        ...book, 
                        userNotes: '', 
                        readingStatus: 'unread', 
                        progress: 0
                    };
                    delete newBook.sharedMetadata;
                    
                    myLibrary.push(newBook);
                    localStorage.setItem('myLibrary_Inspire', JSON.stringify(myLibrary));
                    updateShelfUI();
                    
                    // NEW: Friendly success message for shared book import
                    showToast("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒØªØ§Ø¨ Ù„Ù…ÙƒØªØ¨ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­!", "success");
                    checkAchievements();
                }
            }
        }

        // --- Init Parallax & Magic Modal ---
        document.addEventListener('mousemove', (e) => {
            const stars = document.getElementById('starsContainer');
            const dust = document.getElementById('dustContainer');
            if (stars && dust) {
                const x = (window.innerWidth - e.pageX * 2) / 100;
                const y = (window.innerHeight - e.pageY * 2) / 100;
                stars.style.transform = `translateX(${x}px) translateY(${y}px)`;
                dust.style.transform = `translateX(${x * 2}px) translateY(${y * 2}px)`;
            }
        });

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.1, rootMargin: "0px 0px -50px 0px" });

        // User Name System
        function checkUserName() {
            const name = localStorage.getItem('libraryUserName');
            if (!name) setTimeout(() => document.getElementById('nameModal').classList.remove('hidden'), 1000);
            else {
                updatePersonalizedUI(name);
                document.getElementById('settingsNameInput').value = name;
            }
        }
        
        function saveUserName() {
            const input = document.getElementById('userNameInput');
            const name = input.value.trim();
            if (name) {
                localStorage.setItem('libraryUserName', name);
                document.getElementById('nameModal').classList.add('hidden');
                showToast(`Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø¹Ø§Ù„Ù…Ùƒ ÙŠØ§ ${name}`, 'success');
                updatePersonalizedUI(name);
                document.getElementById('settingsNameInput').value = name;
            } else {
                input.classList.add('animate-pulse', 'border-red-500');
                setTimeout(() => input.classList.remove('animate-pulse', 'border-red-500'), 500);
            }
        }
        
        function updateNameFromSettings() {
            const input = document.getElementById('settingsNameInput');
            const name = input.value.trim();
            if(name) {
                localStorage.setItem('libraryUserName', name);
                updatePersonalizedUI(name);
                showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³Ù… Ø¨Ù†Ø¬Ø§Ø­', 'success');
            }
        }
        
        // Typewriter Effect Logic for Greeting
        function updatePersonalizedUI(name) {
            const hour = new Date().getHours();
            let timeGreeting = "ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ±";
            if(hour >= 12 && hour < 17) timeGreeting = "Ø·Ø§Ø¨ ÙŠÙˆÙ…Ùƒ";
            else if(hour >= 17) timeGreeting = "Ù…Ø³Ø§Ø¡ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©";
            
            document.getElementById('greetingText').innerText = `${timeGreeting}ØŒ ÙŠØ§ ${name}`;
            
            const msg = `Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø¹ÙˆØ¯ØªÙƒ ÙŠØ§ ${name}ØŒ Ù…ÙƒØªØ¨ØªÙƒ Ø¨Ø§Ù†ØªØ¸Ø§Ø±Ùƒ`;
            const welcomeEl = document.getElementById('dynamicWelcome');
            welcomeEl.innerText = "";
            let i = 0;
            
            function typeWriter() {
                if (i < msg.length) {
                    welcomeEl.innerHTML += msg.charAt(i);
                    i++;
                    setTimeout(typeWriter, 50);
                }
            }
            typeWriter();
        }

        // --- Settings / Export / Import Logic ---
        function openSettingsModal() { 
            const name = localStorage.getItem('libraryUserName') || '';
            document.getElementById('settingsNameInput').value = name;
            document.getElementById('settingsModal').classList.remove('hidden'); 
        }
        function closeSettingsModal() { document.getElementById('settingsModal').classList.add('hidden'); }

        function exportLibrary() {
            if(myLibrary.length === 0) {
                showToast('Ù…ÙƒØªØ¨ØªÙƒ ÙØ§Ø±ØºØ©! Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø§ ÙŠÙ…ÙƒÙ† ØªØµØ¯ÙŠØ±Ù‡.', 'info');
                return;
            }
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(myLibrary));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "MyLibrary_Backup.json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
            showToast('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©', 'success');
        }

        function importLibrary(input) {
            const file = input.files[0];
            if(!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if(Array.isArray(data)) {
                        myLibrary = data;
                        localStorage.setItem('myLibrary_Inspire', JSON.stringify(myLibrary));
                        updateShelfUI();
                        showToast('ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                        closeSettingsModal();
                    } else {
                        showToast('Ø§Ù„Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­', 'red');
                    }
                } catch(err) {
                    showToast('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù', 'red');
                }
            };
            reader.readAsText(file);
            input.value = ''; // Reset
        }

        function resetData() {
            if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙƒØªØ¨ ÙˆØ§Ù„Ø§Ø³Ù… ÙˆØ³Ø¬Ù„ Ø§Ù„Ø¨Ø­Ø«.")) {
                localStorage.removeItem('myLibrary_Inspire');
                localStorage.removeItem('libraryUserName');
                localStorage.removeItem('searchHistory_Inspire');
                localStorage.removeItem('unlockedBadges_Inspire');
                location.reload();
            }
        }

        // --- Share Logic (Updated for Copy Link) ---
        async function shareBook() {
            const info = activeBookMoreInfo;
            if(!info || !info.title) return;
            
            const shareData = {
                title: info.title,
                text: `Ø§ÙƒØªØ´ÙØª ÙƒØªØ§Ø¨Ø§Ù‹ Ø±Ø§Ø¦Ø¹Ø§Ù‹ Ø¨Ø¹Ù†ÙˆØ§Ù† "${info.title}" Ø¹Ù„Ù‰ Ù…ÙƒØªØ¨ØªÙŠ ++.`,
                url: info.link || window.location.href
            };

            if (navigator.share) {
                try {
                    await navigator.share(shareData);
                } catch (err) { console.log(err); }
            } else {
                const textToCopy = `${shareData.text} \n ${shareData.url}`;
                navigator.clipboard.writeText(textToCopy);
                
                // Enhanced Notification
                const toastIcon = document.getElementById('toastIcon');
                toastIcon.className = "fa-solid fa-link";
                showToast('ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„ÙƒØªØ§Ø¨ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                setTimeout(() => toastIcon.className = "fa-solid fa-check", 3000);
            }
        }

        // --- Search History Logic ---
        function addToSearchHistory(term) {
            if(!term) return;
            searchHistory = searchHistory.filter(t => t !== term);
            searchHistory.unshift(term);
            if(searchHistory.length > 5) searchHistory.pop();
            localStorage.setItem('searchHistory_Inspire', JSON.stringify(searchHistory));
            renderSearchHistory();
        }

        function renderSearchHistory() {
            const list = document.getElementById('historyList');
            const dropdown = document.getElementById('searchHistoryDropdown');
            
            if(searchHistory.length === 0) {
                dropdown.classList.add('hidden');
                return;
            }
            
            list.innerHTML = searchHistory.map(term => `
                <li onclick="document.getElementById('searchInput').value='${term}'; searchBooks(true);" class="px-4 py-3 hover:bg-slate-700/50 cursor-pointer text-xs text-slate-300 border-b border-slate-700/50 flex justify-between group transition-colors">
                    <span>${term}</span>
                    <i class="fa-solid fa-arrow-turn-down text-slate-600 group-hover:text-indigo-400"></i>
                </li>
            `).join('');
        }

        function clearSearchHistory() {
            searchHistory = [];
            localStorage.removeItem('searchHistory_Inspire');
            renderSearchHistory();
        }

        // --- Init ---
        document.addEventListener('DOMContentLoaded', () => {
            function createStars() {
                const container = document.getElementById('starsContainer');
                for(let i=0; i<50; i++) {
                    const star = document.createElement('div');
                    star.className = 'star';
                    star.style.left = `${Math.random() * 100}%`;
                    star.style.top = `${Math.random() * 100}%`;
                    star.style.setProperty('--duration', `${Math.random() * 3 + 2}s`);
                    star.style.setProperty('--delay', `${Math.random() * 5}s`);
                    container.appendChild(star);
                }
            }
            createStars();
            checkUserName(); 
            const tags = [
                {name: 'ØªØ·ÙˆÙŠØ± Ø°Ø§Øª', id: 'self-help'},
                {name: 'Ø±ÙˆØ§ÙŠØ§Øª', id: 'fiction'},
                {name: 'ØªØ§Ø±ÙŠØ®', id: 'history'},
                {name: 'ØªÙ‚Ù†ÙŠ', id: 'computers'},
                {name: 'ÙÙ„Ø³ÙØ©', id: 'philosophy'}
            ];
            document.getElementById('quickTags').innerHTML = tags.map((t, i) => 
                `<button onclick="document.getElementById('searchInput').value='${t.name}'; searchBooks(true);" 
                class="px-4 py-1.5 bg-slate-800/60 text-xs text-slate-300 rounded-full border border-slate-600 hover:border-indigo-500 hover:bg-indigo-500/10 hover:text-white transition-all whitespace-nowrap animate-slide-up opacity-0 forwards backdrop-blur-sm"
                style="animation-delay: ${0.2 + (i * 0.1)}s">#${t.name}</button>`
            ).join('');
            
            updateShelfUI();
            checkAchievements(); // Initial check
            loadTrending(true);
            
            document.querySelectorAll('.reveal-on-scroll').forEach(el => observer.observe(el));
            
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('keypress', (e) => { if(e.key === 'Enter') searchBooks(true); });
                searchInput.addEventListener('focus', () => {
                    renderSearchHistory();
                    if(searchHistory.length > 0) document.getElementById('searchHistoryDropdown').classList.remove('hidden');
                });

                // --- Live suggestions while typing (debounced) ---
                let suggestionTimer = null;
                let suggestionIndex = -1;
                let currentSuggestions = [];

                function escapeRegex(str) { return str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); }
                function highlightMatch(text, q) {
                    if(!q) return text;
                    try {
                        const r = new RegExp('(' + escapeRegex(q) + ')', 'ig');
                        return text.replace(r, '<mark style="background:rgba(124,58,237,0.14);padding:0 2px;border-radius:3px">$1</mark>');
                    } catch(e) { return text; }
                }

                function levenshtein(a, b){ if(!a||!b) return (a||b)? Math.max(a.length,b.length):0; const dp=[]; for(let i=0;i<=a.length;i++){dp[i]=[i];} for(let j=1;j<=b.length;j++) dp[0][j]=j; for(let i=1;i<=a.length;i++){ for(let j=1;j<=b.length;j++){ dp[i][j]= a[i-1]===b[j-1]? dp[i-1][j-1] : Math.min(dp[i-1][j]+1, dp[i][j-1]+1, dp[i-1][j-1]+1); } } return dp[a.length][b.length]; }

                async function fetchRemoteSuggestions(q, limit=5){
                    try{
                        const res = await fetch(`https://www.googleapis.com/books/v1/volumes?q=${encodeURIComponent(q)}&maxResults=${limit}`);
                        const data = await res.json();
                        return (data.items||[]).map(it=>({
                            id: it.id,
                            title: it.volumeInfo.title || 'ØºÙŠØ± Ù…Ø¹Ø±Ù',
                            authors: it.volumeInfo.authors || [],
                            thumbnail: (it.volumeInfo.imageLinks?.thumbnail||'').replace('http:','https:'),
                            categories: it.volumeInfo.categories || [],
                            pageCount: it.volumeInfo.pageCount || 0,
                            source: 'remote'
                        }));
                    }catch(e){ return []; }
                }

                function scoreCandidate(item, q){
                    const qlow = q.toLowerCase();
                    let score = 0;
                    if(item.source === 'local') score += 30;
                    const title = (item.title||'').toLowerCase();
                    if(title === qlow) score += 40; else if(title.startsWith(qlow)) score += 20; else if(title.includes(qlow)) score += 10; else if(levenshtein(title, qlow) <= 2) score += 6;
                    const author = (item.authors||[]).join(' ').toLowerCase(); if(author.includes(qlow)) score += 8;
                    return score;
                }

                async function generateSuggestions(q){
                    if(!q || q.trim().length === 0) return [];
                    const qtrim = q.trim();
                    const candidates = [];
                    // local saved books first
                    myLibrary.forEach(b => {
                        const info = b.volumeInfo || {};
                        candidates.push({ id: b.id, title: info.title||'', authors: info.authors||[], thumbnail: (info.imageLinks?.thumbnail||'').replace('http:','https:'), categories: info.categories||[], pageCount: info.pageCount||0, source:'local' });
                    });
                    // cached search results
                    currentBooksCache.forEach(b => {
                        const info = b.volumeInfo || {};
                        candidates.push({ id: b.id, title: info.title||'', authors: info.authors||[], thumbnail: (info.imageLinks?.thumbnail||'').replace('http:','https:'), categories: info.categories||[], pageCount: info.pageCount||0, source:'cache' });
                    });

                    // de-dupe by id
                    const map = new Map();
                    candidates.forEach(c => { if(!map.has(c.id)) map.set(c.id, c); });
                    let list = Array.from(map.values());

                    // filter by loose match first
                    list = list.filter(it => {
                        const ql = qtrim.toLowerCase();
                        const inTitle = (it.title||'').toLowerCase().includes(ql);
                        const inAuthor = (it.authors||[]).join(' ').toLowerCase().includes(ql);
                        const close = levenshtein((it.title||'').toLowerCase(), ql) <= 2;
                        return inTitle || inAuthor || close;
                    });

                    // score & sort
                    list = list.map(it=>({it, score: scoreCandidate(it, qtrim)})).sort((a,b)=>b.score-a.score).map(x=>x.it);

                    // if not enough, fetch remote
                    if(list.length < 6){
                        const remote = await fetchRemoteSuggestions(qtrim, 6);
                        remote.forEach(r => { if(!map.has(r.id)) list.push(r); });
                    }

                    // final trimming and tagging
                    return list.slice(0,7);
                }

                function renderSuggestions(suggestions, q){
                    const container = document.getElementById('suggestionsList');
                    const dropdown = document.getElementById('suggestionsDropdown');
                    container.innerHTML = '';
                    currentSuggestions = suggestions;
                    suggestionIndex = -1;
                    if(!suggestions || suggestions.length === 0){
                        dropdown.classList.remove('hidden');
                        container.innerHTML = `<div class="no-results">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ÙƒØªØ¨ Ù…Ø·Ø§Ø¨Ù‚Ø©ØŒ Ø¬Ø±Ù‘Ø¨ ÙƒÙ„Ù…Ø§Øª Ø£Ø®Ø±Ù‰</div>`;
                        document.getElementById('suggestionsFooter').classList.add('hidden');
                        return;
                    }

                    suggestions.forEach((s, idx) => {
                        const div = document.createElement('div');
                        div.className = 'suggestion-item';
                        div.dataset.index = idx;
                        div.innerHTML = `
                            <img class="thumb" src="${s.thumbnail || 'https://via.placeholder.com/80x120?text=No'}" alt="cover">
                            <div class="meta">
                                <div class="title">${highlightMatch(s.title, q)}</div>
                                <div class="author">${(s.authors||[]).slice(0,2).join('ØŒ ') || 'Ù…Ø¤Ù„Ù ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                            </div>
                            ${ (s.title && s.title.toLowerCase().trim() === q.toLowerCase().trim()) ? '<div class="badge">Ù…Ø·Ø§Ø¨Ù‚ ØªÙ…Ø§Ù…Ù‹Ø§</div>' : '' }
                        `;
                        div.addEventListener('click', (ev)=>{ ev.stopPropagation(); document.getElementById('suggestionsDropdown').classList.add('hidden'); if(s && s.id) openDetails(s.id); });
                        container.appendChild(div);
                    });
                    document.getElementById('suggestionsFooter').classList.remove('hidden');
                    document.getElementById('suggestionsFooter').innerText = 'Ø§Ø¶ØºØ· Enter Ø£Ùˆ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ù†ØªÙŠØ¬Ø© Ù„Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙƒØªØ§Ø¨';
                    dropdown.classList.remove('hidden');
                }

                function hideSuggestions(){ document.getElementById('suggestionsDropdown').classList.add('hidden'); suggestionIndex = -1; currentSuggestions = []; }

                searchInput.addEventListener('input', (e)=>{
                    const q = e.target.value || '';
                    // hide history when typing
                    document.getElementById('searchHistoryDropdown').classList.add('hidden');
                    if(suggestionTimer) clearTimeout(suggestionTimer);
                    suggestionTimer = setTimeout(async ()=>{
                        if(!q || q.trim().length === 0) { hideSuggestions(); return; }
                        const suggestions = await generateSuggestions(q);
                        renderSuggestions(suggestions, q);
                    }, 300);
                });

                // keyboard navigation
                searchInput.addEventListener('keydown', (e)=>{
                    const dropdown = document.getElementById('suggestionsDropdown');
                    if(dropdown.classList.contains('hidden')) return;
                    if(e.key === 'ArrowDown' || e.key === 'ArrowUp'){
                        e.preventDefault();
                        const items = Array.from(document.querySelectorAll('#suggestionsList .suggestion-item'));
                        if(items.length === 0) return;
                        if(e.key === 'ArrowDown') suggestionIndex = Math.min(suggestionIndex + 1, items.length - 1);
                        else suggestionIndex = Math.max(suggestionIndex - 1, 0);
                        items.forEach(it=>it.classList.remove('active'));
                        items[suggestionIndex].classList.add('active');
                        items[suggestionIndex].scrollIntoView({block: 'nearest'});
                    } else if(e.key === 'Enter'){
                        if(suggestionIndex >= 0 && currentSuggestions[suggestionIndex]){
                            e.preventDefault();
                            const id = currentSuggestions[suggestionIndex].id;
                            hideSuggestions();
                            openDetails(id);
                        }
                    } else if(e.key === 'Escape'){
                        hideSuggestions();
                    }
                });
            }
            
            document.addEventListener('click', (e) => {
                if(!e.target.closest('#searchInput') && !e.target.closest('#searchHistoryDropdown')) {
                    const dropdown = document.getElementById('searchHistoryDropdown');
                    if (dropdown) dropdown.classList.add('hidden');
                }
            });

            const notes = document.getElementById('bookNotes');
            if (notes) {
                notes.addEventListener('input', (e) => {
                    const id = document.getElementById('bookModal').dataset.activeId;
                    if(id) saveNote(id, e.target.value);
                });
            }

            window.addEventListener('scroll', () => {
                const btn = document.getElementById('scrollTopBtn');
                if (btn) {
                    if (window.scrollY > 300) btn.classList.add('visible');
                    else btn.classList.remove('visible');
                }
            });
            
            checkSharedUrl();
        });

        function stringToColor(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) hash = str.charCodeAt(i) + ((hash << 5) - hash);
            const c = (hash & 0x00FFFFFF).toString(16).toUpperCase();
            return '#' + '00000'.substring(0, 6 - c.length) + c;
        }
        
        function showToast(msg, type='success') {
            const toast = document.getElementById('toast');
            const msgEl = document.getElementById('toastMsg');
            const title = document.getElementById('toastTitle');
            const wrapper = document.getElementById('toastIconWrapper');
            const icon = document.getElementById('toastIcon');
            
            if (!toast || !msgEl || !title || !wrapper || !icon) return;

            msgEl.innerText = msg;
            
            // If we didn't just override it with "Link", reset/set icons based on type
            if(icon.className.includes('fa-link')) {
                 // Keep link icon for this call if set externally
            } else {
                if(type === 'success') {
                    title.innerText = "Ù…Ù…ØªØ§Ø²";
                    wrapper.className = "bg-green-500/20 p-2 rounded-full text-green-500";
                    icon.className = "fa-solid fa-check";
                } else if (type === 'red') {
                    title.innerText = "ØªÙ†Ø¨ÙŠÙ‡";
                    wrapper.className = "bg-red-500/20 p-2 rounded-full text-red-500";
                    icon.className = "fa-solid fa-trash-can";
                } else {
                    title.innerText = "Ù…Ø¹Ù„ÙˆÙ…Ø©";
                    wrapper.className = "bg-blue-500/20 p-2 rounded-full text-blue-500";
                    icon.className = "fa-solid fa-info";
                }
            }
            
            toast.classList.remove('translate-y-24', 'opacity-0');
            setTimeout(() => toast.classList.add('translate-y-24', 'opacity-0'), 3000);
        }
        
        function goHome() {
            document.getElementById('resultsArea').classList.add('hidden');
            document.getElementById('homeView').classList.remove('hidden');
            const searchInput = document.getElementById('searchInput');
            if (searchInput) searchInput.value = '';
        }
        
        function closeModal() {
            const modal = document.getElementById('bookModal');
            modal.classList.add('opacity-0');
            document.getElementById('modalContent').classList.add('scale-95');
            setTimeout(() => modal.classList.add('hidden'), 300);
        }
        
        function toggleShelf() {
            const shelf = document.getElementById('myShelf');
            const overlay = document.getElementById('overlay');
            if (shelf.classList.contains('-translate-x-full')) {
                shelf.classList.remove('-translate-x-full');
                overlay.classList.remove('hidden');
                setTimeout(() => overlay.classList.remove('opacity-0'), 10);
                // Check achievements when opening shelf to update UI
                checkAchievements();
            } else {
                shelf.classList.add('-translate-x-full');
                overlay.classList.add('opacity-0');
                setTimeout(() => overlay.classList.add('hidden'), 300);
            }
        }

        // Toggle expanded shelf (grid / larger view)
        function toggleShelfView() {
            const shelf = document.getElementById('myShelf');
            const btn = document.getElementById('expandShelfBtn');
            if (!shelf) return;
            shelf.classList.toggle('shelf-expanded');
            if(btn) btn.classList.toggle('active');
            // when expanding, ensure content scroll resets and is visible
            const content = document.getElementById('shelfContent');
            if(content) {
                content.style.minHeight = '180px';
                content.scrollTop = 0;
            }
        }
        
        // NEW Function: Toggle Focus Mode (Show Only Books)
        function toggleShelfFocus() {
            const panels = document.querySelectorAll('.shelf-section');
            const btn = document.getElementById('shelfFocusBtn');
            
            let isHiding = false;
            
            panels.forEach(p => {
                if (!p.classList.contains('hidden')) isHiding = true;
                p.classList.toggle('hidden');
            });
            
            if (isHiding) {
                // We just hid everything -> Focus Mode ON
                btn.classList.add('bg-yellow-600', 'text-white');
                btn.classList.remove('bg-slate-800', 'text-yellow-500');
            } else {
                                // We just showed everything -> Focus Mode OFF
                                btn.classList.remove('bg-yellow-600', 'text-white');
                                btn.classList.add('bg-slate-800', 'text-yellow-500');
                            }
                        }
                
                        function flyToCart(element, imgUrl) {
                            const cartBtn = document.getElementById('cartBtn');
                            if (!element || !cartBtn) return;
                            
                            const img = new Image();
                            img.src = imgUrl;
                            img.className = 'flying-img';
                            
                            const rect = element.getBoundingClientRect();
                            const cartRect = cartBtn.getBoundingClientRect();
                            
                            img.style.top = rect.top + 'px';
                            img.style.left = rect.left + 'px';
                            img.style.width = rect.width + 'px';
                            img.style.height = rect.height + 'px';
                            
                            document.body.appendChild(img);
                            
                            setTimeout(() => {
                                img.style.top = cartRect.top + 'px';
                                img.style.left = cartRect.left + 'px';
                                img.style.width = '40px';
                                img.style.height = '60px';
                                img.style.opacity = '0';
                            }, 10);
                            
                            setTimeout(() => img.remove(), 800);
                        }
                    </script>
                </body>
                </html>
